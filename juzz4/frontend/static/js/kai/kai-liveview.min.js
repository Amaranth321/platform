angular.module("kai.liveview",["FBAngular"]),angular.module("kai.liveview").factory("LiveviewPlayerService",["KupOption","UtilsService","KupApiService","AuthTokenFactory","DeviceTreeService","LiveviewService","$q","$filter","$timeout",function(KupOption,UtilsService,KupApiService,AuthTokenFactory,DeviceTreeService,LiveviewService,$q,$filter,$timeout){function getVLC(name){return window.document[name]?window.document[name]:navigator.appName.indexOf("Microsoft Internet")!=-1?document.getElementById(name):document.embeds&&document.embeds[name]?document.embeds[name]:void 0}var utils=UtilsService,kupPlayer=(UtilsService.i18n,UtilsService.i18n,{});return kupPlayer.retryOnErrorList={},kupPlayer.init=function(slotId,playerId,urlList,playerType,deviceDetail,showControlbar,showPlaylist){"jw"==playerType?kupPlayer._playWithJW(playerId,urlList,showControlbar,showPlaylist,slotId,deviceDetail):"vlc"==playerType&&kupPlayer._playWithVlc(playerId,urlList,showControlbar,slotId)},kupPlayer.getCurrentPosition=function(playerId){var jwPlayer=jwplayer(playerId);return null==jwPlayer?(console.error("getCurrentPosition: player not initialized"),null):jwPlayer.getPosition()},kupPlayer.setCurrentPosition=function(playerId,timeInSeconds){var jwPlayer=jwplayer(playerId);return null==jwPlayer?void console.error("getCurrentPosition: player not initialized"):void jwPlayer.seek(timeInSeconds)},kupPlayer._playWithJW=function(playerId,urlList,showControlbar,showPlaylist,slotId,deviceDetail){var customSkin="static/js/plugin/jwplayer/skin/six.xml",listbar=!1,autoStart=!(urlList.length>1);showControlbar&&(customSkin="static/js/plugin/jwplayer/skin/liveview.xml"),showPlaylist&&(listbar={position:"right",size:260});var playlist=[];$.each(urlList,function(index,url){var fileName=index+1;playlist.push({title:fileName,image:"static/images/assets/common/play.png",file:url})});jwplayer(playerId).setup({playlist:playlist,width:"100%",height:"100%",listbar:listbar,flashplayer:"static/js/plugin/jwplayer/jwplayer.flash.swf",html5player:"static/js/plugin/jwplayer/jwplayer.html5.min.js",autostart:autoStart,mute:!0,rtmp:{bufferlength:2},skin:customSkin,captions:{back:!1,color:"cc00000",fontsize:20},controls:!!showControlbar,analytics:{enabled:!1,cookies:!1},events:{onDisplayClick:function(event){var opt=LiveviewService.data,viewType=this.id.split("_")[1],playerIndex=parseInt(this.id.split("_")[2],10),state=this.getState();$.each(opt.playerList,function(type,playerData){if(type!==viewType)return!0;playerData[playerIndex];"PLAYING"!==state&&"BUFFERING"!==state||(opt.playerList[type][playerIndex].isPlay=!0),"PAUSED"!==state&&"IDLE"!==state||(opt.playerList[type][playerIndex].isPlay=!1)}),LiveviewService.playerSelected(viewType,playerIndex)}}})},kupPlayer._playWithVlc=function(playerId,urlList,toolbarFlag,slotId){var embedCode='<OBJECT classid="clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921" codebase="http://downloads.videolan.org/pub/videolan/vlc/latest/win32/axvlc.cab" width="100%" height="100%" id="'+playerId+'" events="True"> <param name="MRL" value="" /> <param name="ShowDisplay" value="True" /> <param name="AutoLoop" value="False" /> <param name="AutoPlay" value="False" /> <param name="toolbar" value="'+toolbarFlag+'" /> <param name="StartTime" value="0" /> <EMBED pluginspage="" type="application/x-vlc-plugin" version="VideoLAN.VLCPlugin.2" width="100%" height="100%" toolbar="'+toolbarFlag+'" text="Waiting for video" name="'+playerId+'"> </EMBED> </OBJECT> ';"ie"==utils.detectBrowser()?getVLC(slotId).innerHTML=embedCode:document.getElementById(slotId).innerHTML=embedCode;var vlc=getVLC(playerId);$.each(urlList,function(index,item){vlc.playlist.add(item)}),vlc.playlist.play(),vlc.audio.toggleMute(),"ie"==utils.detectBrowser()&&(vlc.style.width="100%",vlc.style.height="100%")},kupPlayer.getJWUrlList=function(urlList){var playlist=[];return $.each(urlList,function(index,url){var fileName=index+1;playlist.push({title:fileName,image:"static/images/assets/common/play.png",file:url})}),playlist},{kupPlayer:kupPlayer}}]),angular.module("kai.liveview").factory("LiveviewService",["KupOption","UtilsService","KupApiService","AuthTokenFactory","DeviceTreeService","$q","$filter","$timeout",function(KupOption,UtilsService,KupApiService,AuthTokenFactory,DeviceTreeService,$q,$filter,$timeout){function initData(){var opt=data,playerList={};$.each(opt.uiViewType,function(i,type){playerList[type.name]=new Array(type.count)}),opt.playerList=playerList}function setTreeList(){var opt=data,treeItems=DeviceTreeService.getDeviceTree();opt.uiTreeview.list=function(){var tree=angular.copy(treeItems),treeList=[];return $.each(tree,function(i,label){var deviceData=label.items;$.each(deviceData,function(j,device){device.isNode||(device.items=[])}),treeList.push(label)}),treeList}()}function setPlayerList(viewTypeName,playerIndex,playerId,cameraData){var opt=data;opt.playerList[viewTypeName][playerIndex]={playerId:playerId,cameraData:cameraData,isAssignCamera:!0,isLoadVideo:!1,isLoadVideoing:!1,isSelected:!1,isShowInfo:!1,isPlay:!0}}function setCurrectViewType(index){var opt=data;$.each(opt.uiViewType,function(i,list){list.isActive=index==i})}function setCurrectFilterVca(index){var opt=data;$.each(opt.uiFilterVca.list,function(i,list){list.isActive=index==i})}function getCurrectFilterVca(){var opt=data,sortItems=[];return $.each(opt.uiFilterVca.list,function(i,list){if(list.isActive)return sortItems=list,!1}),sortItems}function getDeviceTree(){return DeviceTreeService.initDeviceTree()["finally"](function(){setTreeList()})}function getUserPrefsApi(isDefer){var opt=data,param={},onSuccess=function(response){opt.apiUserPrefs=response.prefs||{},opt.autoRotation=response.prefs.autoRotation,opt.autoRotationTime=response.prefs.autoRotationTime},onFail=function(response){opt.apiUserPrefs={}},onError=function(){opt.apiUserPrefs={}};return ajaxPost("getuserprefs",param,onSuccess,onFail,onError,isDefer)}function saveUserPrefsApi(isDefer){var opt=data,param={"auto-rotation":opt.autoRotation,"auto-rotation-time":opt.autoRotationTime},onSuccess=function(response){notification("success",i18n("update-successful"))},onFail=function(response){notification("warning",i18n("update-failed"))},onError=function(){notification("warning",i18n("update-failed"))};return ajaxPost("saveuserprefs",param,onSuccess,onFail,onError,isDefer)}function getLiveVideoUrlApi(viewTypeName,playerIndex,cameraData,isDefer){var opt=data,streamType=function(){var streamType="http/mjpeg";return cameraData.fullData.model.capabilities.indexOf("h264")!=-1&&(streamType="rtmp/h264"),streamType}(),param={"device-id":cameraData.deviceId,"channel-id":cameraData.cameraId,"stream-type":streamType},onSuccess=function(response){opt.apiLiveVideoUrl[viewTypeName][playerIndex]={streamingSessionKey:response["streaming-session-key"],ttlSeconds:response["ttl-seconds"],url:response.url}},onFail=function(response){opt.apiLiveVideoUrl[viewTypeName][playerIndex]={}},onError=function(){opt.apiLiveVideoUrl[viewTypeName][playerIndex]={}};return ajaxPost("getlivevideourl",param,onSuccess,onFail,onError,isDefer)}function getActiveViewType(){var opt=data,viewType={};return $.each(opt.uiViewType,function(i,type){if(type.isActive)return viewType=type,!1}),viewType}function getSelectedPlayer(){var opt=data,playerInfo={};return $.each(opt.playerList,function(type,playerAry){$.each(playerAry,function(i,player){if(player&&player.isSelected)return playerInfo=player,!1})}),playerInfo}function cancelSelectedPlayer(){var opt=data;$.each(opt.playerList,function(type,playerAry){$.each(playerAry,function(i,player){player&&(player.isSelected=!1)})})}function playerSelected(viewTypeName,playerIndex){var opt=data;opt.playerList[viewTypeName][playerIndex]&&opt.playerList[viewTypeName][playerIndex].isAssignCamera&&(cancelSelectedPlayer(),opt.playerList[viewTypeName][playerIndex].isSelected=!0)}var kupOpt=KupOption,i18n=UtilsService.i18n,notification=UtilsService.notification,ajaxPost=KupApiService.ajaxPost,data={};return data.$section="#liveviewSection",data.$treeview="#liveviewTreeview",data.$search="#liveviewSearch",data.$dragTarget="#liveviewDragTarget",data.uiMenu={isShow:!0},data.uiFilterVca={isOpen:!1,list:function(){var list=[];return $.each(kupOpt.vca,function(i,vca){list.push({name:vca.name,type:vca.analyticsType,isActive:!1})}),list.unshift({name:"all",type:"ALL",isActive:!0}),list}()},data.uiTreeview={options:{},list:[],searchValue:""},data.uiDragTarget={options:{},list:[],isShow:!1},data.dragTargetIdPrefix="liveviewDragTarget",data.playerIdPrefix="liveviewPlayer",data.uiViewType=[{name:"oneview",text:"1-view",classBtn:"kup-oneview",classGroup:"kupOneView",isActive:!0,count:1,dragTargetIdPrefix:"liveviewDragTarget_oneview_",playerIdPrefix:"liveviewPlayer_oneview_"},{name:"fourview",text:"4-view",classBtn:"kup-fourviews",classGroup:"kupFourViews",isActive:!1,count:4,dragTargetIdPrefix:"liveviewDragTarget_fourview_",playerIdPrefix:"liveviewPlayer_fourview_"},{name:"nineview",text:"9-view",classBtn:"kup-nineviews",classGroup:"kupNineViews",isActive:!1,count:9,dragTargetIdPrefix:data.dragTargetIdPrefix+"_nineview_",playerIdPrefix:data.playerIdPrefix+"_nineview_"}],data.isInitEnd=!1,data.isSuccessDrag=!1,data.isDragging=!1,data.isFullScreen=!1,data.isPlayerFullScreen=!1,data.currectFullScreenId="",data.draggedItemData={},data.autoRotation=!1,data.autoRotationTime=15,data.autoRotationTimeMin=15,data.autoRotationTimeMax=3600,data.autoRotationPromise=null,data.playerList=function(){var playerList={};return $.each(data.uiViewType,function(i,type){playerList[type.name]=new Array(type.count)}),playerList}(),data.apiUserPrefs={},data.apiLiveVideoUrl=function(){var apiLivevideourl={};return $.each(data.uiViewType,function(i,type){apiLivevideourl[type.name]=new Array(type.count)}),apiLivevideourl}(),{data:data,initData:initData,setTreeList:setTreeList,setCurrectViewType:setCurrectViewType,setCurrectFilterVca:setCurrectFilterVca,setPlayerList:setPlayerList,getCurrectFilterVca:getCurrectFilterVca,getDeviceTree:getDeviceTree,getUserPrefsApi:getUserPrefsApi,saveUserPrefsApi:saveUserPrefsApi,getLiveVideoUrlApi:getLiveVideoUrlApi,getActiveViewType:getActiveViewType,getSelectedPlayer:getSelectedPlayer,cancelSelectedPlayer:cancelSelectedPlayer,playerSelected:playerSelected}}]),angular.module("kai.liveview").controller("LiveviewController",["KupOption","RouterStateService","UtilsService","AuthTokenFactory","Fullscreen","LiveviewService","LiveviewPlayerService","DeviceTreeService","MainService","$scope","$q","$timeout","$interval","$filter","$animate","$rootScope",function(KupOption,RouterStateService,UtilsService,AuthTokenFactory,Fullscreen,LiveviewService,LiveviewPlayerService,DeviceTreeService,MainService,$scope,$q,$timeout,$interval,$filter,$animate,$rootScope){function init(){initData(),setWatch()}function initData(){LiveviewService.initData()}function setWatch(){$scope.$watch(function(){return angular.toJson(RouterStateService.getRouterState())},function(newVal,oldVal){var routerState=angular.fromJson(newVal).toState,routerCheck=/\.liveview/.test(routerState.name);return routerCheck?void(mainCtrl.block.promise=loadUI()):(disableRotation(),!1)},!0),$scope.$watch("liveviewCtrl.data.uiFilterVca.list",function(newVal,oldVal){liveviewCtrl.data;angular.toJson(newVal)!==angular.toJson(oldVal)&&$timeout(function(){setTreeviewForFilter()},300)},!0),$scope.$watch("liveviewCtrl.data.uiTreeview.searchValue",function(newVal,oldVal){liveviewCtrl.data;newVal!==oldVal&&$timeout(function(){setTreeviewForFilter()},300)},!0),$scope.$watch("liveviewCtrl.data.autoRotationTime",function(newVal,oldVal){var opt=liveviewCtrl.data,autoRotationTime=parseInt(newVal,10);autoRotationTime>opt.autoRotationTimeMax&&(opt.autoRotationTime=opt.autoRotationTimeMax),autoRotationTime<opt.autoRotationTimeMin&&(opt.autoRotationTime=opt.autoRotationTimeMin)},!0),$scope.$watch("liveviewCtrl.data.playerList",function(newVal,oldVal){liveviewCtrl.data;angular.toJson(newVal)!==angular.toJson(oldVal)&&$.each(newVal,function(type,player){return LiveviewService.getActiveViewType().name!==type||void $.each(player,function(i,info){return!(info&&!$.isEmptyObject(info.cameraData))||(oldVal[type][i]?angular.toJson(info.cameraData)!==angular.toJson(oldVal[type][i].cameraData)?(loadVideo(type,i,info.cameraData),!0):void 0:(loadVideo(type,i,info.cameraData),!0))})})},!0),$scope.$watch("liveviewCtrl.data.uiViewType",function(newVal,oldVal){var opt=liveviewCtrl.data;opt.playerList;angular.toJson(newVal)!==angular.toJson(oldVal)&&LiveviewService.cancelSelectedPlayer()},!0),$scope.$watch("liveviewCtrl.data.autoRotation",function(newVal,oldVal){liveviewCtrl.data;newVal?autoRotation():disableRotation()},!0),$rootScope.$on("FBFullscreen.change",function(fullscreen,isEnabled){var opt=liveviewCtrl.data,fullScreenClass="kupFullScreen";opt.isFullScreen=isEnabled,opt.currectFullScreenId=$(UtilsService.getFullScreenElement()).attr("id"),opt.isPlayerFullScreen=function(){return new RegExp(opt.dragTargetIdPrefix).test(opt.currectFullScreenId)}(),isEnabled?($(opt.$section).find("."+fullScreenClass).removeClass(fullScreenClass),$("#"+opt.currectFullScreenId).addClass(fullScreenClass)):$(opt.$section).find("."+fullScreenClass).removeClass(fullScreenClass)})}function loadUI(){var opt=liveviewCtrl.data,dfd=$q.defer();return $timeout(function(){LiveviewService.getDeviceTree()["finally"](function(){LiveviewService.getUserPrefsApi()["finally"](function(){setTreeview(),opt.isInitEnd=!0,dfd.resolve()})})}),dfd.promise}function setTreeview(){var opt=liveviewCtrl.data,treeview=$(opt.$treeview).data("kendoTreeView");treeview.dataSource.filter({}),treeview.dataSource.data(opt.uiTreeview.list)}function setTreeviewForFilter(){var opt=liveviewCtrl.data,treeview=$(opt.$treeview).data("kendoTreeView"),filterVcaVal=getCurrectFilterVca(),filterSearchVal=$.trim(opt.uiTreeview.searchValue),filterVca="all"===filterVcaVal.name?{}:{field:"filterVca",operator:"contains",value:filterVcaVal.type},filterSearch=""===filterSearchVal?{}:{field:"filterText",operator:"contains",value:filterSearchVal},filterConfig=function(filterAry){var filter=[];return $.each(filterAry,function(i,data){$.isEmptyObject(data)||filter.push(data)}),0===filter.length&&(filter={}),filter}([filterVca,filterSearch]),filterVcaCheck="all"==filterVcaVal.name?new RegExp(""):new RegExp(filterVcaVal.type),filterSearchCheck=new RegExp(filterSearchVal,"i"),uidExpandList=[],execFilter=function(){treeview.collapse(".k-item"),$.each(treeview.dataSource.data(),function(i,labelData){if(labelData.children){var labelFilterText=function(){var tmpAry=labelData.filterText.split(",");return tmpAry.splice(0,1),tmpAry.toString(",")}();!function(){""===filterSearchVal&&("all"===filterVcaVal.name,"all"!==filterVcaVal.name&&filterVcaCheck.test($.trim(labelData.filterVca))&&uidExpandList.push(labelData.uid)),""!==filterSearchVal&&("all"===filterVcaVal.name&&filterSearchCheck.test($.trim(labelFilterText))&&uidExpandList.push(labelData.uid),"all"!==filterVcaVal.name&&filterSearchCheck.test($.trim(labelFilterText))&&filterVcaCheck.test($.trim(labelData.filterVca))&&uidExpandList.push(labelData.uid))}(),labelData.children.filter(filterConfig),$.each(labelData.children.data(),function(j,deviceData){if(deviceData.children){var deviceFilterText=function(){var tmpAry=deviceData.filterText.split(",");return tmpAry.splice(0,2),tmpAry.toString(",")}();!function(){""===filterSearchVal&&"all"!==filterVcaCheck&&filterVcaCheck.test($.trim(deviceData.filterVca))&&uidExpandList.push(deviceData.uid),""!==filterSearchVal&&("all"===filterVcaCheck&&filterSearchCheck.test($.trim(deviceFilterText))&&uidExpandList.push(deviceData.uid),"all"!==filterVcaCheck&&filterSearchCheck.test($.trim(deviceFilterText))&&filterVcaCheck.test($.trim(deviceData.filterVca))&&uidExpandList.push(deviceData.uid))}(),deviceData.children.filter(filterConfig)}})}}),treeview.dataSource.filter(filterConfig),$.each(uidExpandList,function(i,uid){treeview.expand('[data-uid="'+uid+'"]')})};$timeout(function(){execFilter()})}function setCurrectViewType(index){LiveviewService.setCurrectViewType(index)}function setCurrectFilterVca(index){LiveviewService.setCurrectFilterVca(index)}function getCurrectFilterVca(){return LiveviewService.getCurrectFilterVca()}function fullScreen(id){liveviewCtrl.data;Fullscreen.isEnabled()?Fullscreen.cancel():Fullscreen.enable(document.getElementById(id))}function getTreeviewOptions(){return{dragAndDrop:!0,template:"# if(item.isOnline == false){ ##=item.text # <i class='fa fa-times-circle-o' uib-tooltip='"+i18n("offline")+"' tooltip-placement='right'></i># } else { ##=item.text ## } #",dataSource:function(){var opt=liveviewCtrl.data;return opt.uiTreeview.list}(),expand:function(e){},dragstart:function(e){var opt=liveviewCtrl.data,treeview=$(opt.$treeview).data("kendoTreeView"),draggedItem=(treeview.dataItem(e.sourceNode).uid,treeview.dataItem(e.sourceNode));return opt.dragItem=!0,opt.isSuccessDrag=!0,opt.draggedItemData={},draggedItem.isLabel&&!draggedItem.items.length?(notification("warning","<a ui-sref='main.label' style='text-decoration: underline;'>"+i18n("select-empty-label-error-information")+"</a>",5e3),opt.isSuccessDrag=!1,!1):draggedItem.isOnline===!1?(notification("warning",i18n("offline-device-not-supported")),opt.isSuccessDrag=!1,!1):(opt.draggedItemData=draggedItem,void(opt.isDragging=!0))},drag:function(e){var opt=liveviewCtrl.data,dropTargetIdName=opt.$dragTarget.substring(1);$(e.dropTarget).attr("id")!==dropTargetIdName&&$(e.dropTarget).parents(opt.$dragTarget).attr("id")!==dropTargetIdName||!opt.isSuccessDrag||e.setStatusClass("k-add")},drop:function(e){e.preventDefault();var opt=liveviewCtrl.data;opt.dragItem=!1;var dropTargetIdName=opt.$dragTarget.substring(1);opt.isDragging=!1,($(e.dropTarget).attr("id")!==dropTargetIdName&&$(e.dropTarget).parents(opt.$dragTarget).attr("id")!==dropTargetIdName||!opt.isSuccessDrag)&&e.setValid(!1)}}}function getDragTargetOptions(){return{drop:function(e){var opt=liveviewCtrl.data;if(!opt.isSuccessDrag)return!1;var dropTargetIdName=opt.$dragTarget.substring(1),uiViewType=($(opt.$treeview).data("kendoTreeView"),LiveviewService.getActiveViewType()),targetId=function(){var target=$("html").hasClass("k-mobile")?$(e.dropTarget):$(e.target),targetId=target.attr("id")||"";return targetId=targetId.indexOf(dropTargetIdName)!==-1?target.attr("id"):target.parentsUntil("[id^='"+dropTargetIdName+"']").last().parent().attr("id")}(),playerId=function(){var playerId="",isAddPlayerId=$("#"+targetId).find("[id*='_wrapper']").attr("id")||"";return playerId=isAddPlayerId?isAddPlayerId.replace("_wrapper",""):$("#"+targetId).find(".kupPlayer").attr("id")}(),playerIdAry=playerId.split("_"),playerIndex=parseInt(playerIdAry[playerIdAry.length-1],10),deviceData=(LiveviewService.getActiveViewType(),angular.copy(opt.draggedItemData)),cameraList=function(){var cameraList=[];return(deviceData.isAll||deviceData.isLabel)&&$.each(deviceData.items,function(i,device){$.each(device.items,function(j,camera){cameraList.push(camera)})}),deviceData.isDevice&&$.each(deviceData.items,function(i,camera){cameraList.push(camera)}),deviceData.isCamera&&cameraList.push(deviceData),cameraList}(),uiViewType=LiveviewService.getActiveViewType();!function(){1==cameraList.length?LiveviewService.setPlayerList(uiViewType.name,playerIndex,playerId,cameraList[0]):$.each(cameraList,function(i,camera){i<uiViewType.count&&LiveviewService.setPlayerList(uiViewType.name,i,uiViewType.playerIdPrefix+i,camera)})}()}}}function loadVideo(viewTypeName,playerIndex,cameraData){var opt=liveviewCtrl.data,playerId=opt.playerList[viewTypeName][playerIndex].playerId;jwplayer(playerId)&&jwplayer(playerId).getState()&&jwplayer(playerId).remove(),opt.playerList[viewTypeName][playerIndex].isLoadVideoing=!0,LiveviewService.getLiveVideoUrlApi(viewTypeName,playerIndex,cameraData).success(function(){var opt=liveviewCtrl.data;opt.playerList[viewTypeName][playerIndex].playerId;$.isEmptyObject(opt.apiLiveVideoUrl[viewTypeName][playerIndex])?opt.playerList[viewTypeName][playerIndex].isLoadVideo=!1:(opt.playerList[viewTypeName][playerIndex].isLoadVideo=!0,LiveviewPlayerService.kupPlayer._playWithJW(opt.playerList[viewTypeName][playerIndex].playerId,opt.apiLiveVideoUrl[viewTypeName][playerIndex].url,!0,!1,"",null))}).error(function(){var opt=liveviewCtrl.data;opt.playerList[viewTypeName][playerIndex].isLoadVideo=!1})["finally"](function(){opt.playerList[viewTypeName][playerIndex].isLoadVideoing=!1})}function getCountAry(count){return new Array(count)}function getSelectedPlayer(){return LiveviewService.getSelectedPlayer()}function playerHoverIn(viewTypeName,playerIndex){var opt=liveviewCtrl.data;opt.isDragging||opt.playerList[viewTypeName][playerIndex]&&(opt.playerList[viewTypeName][playerIndex].isShowInfo=!0)}function playerHoverOut(viewTypeName,playerIndex){var opt=liveviewCtrl.data;opt.isDragging||opt.playerList[viewTypeName][playerIndex]&&(opt.playerList[viewTypeName][playerIndex].isShowInfo=!1)}function playerPause(viewTypeName,playerIndex){var opt=liveviewCtrl.data,playerId=opt.playerList[viewTypeName][playerIndex].playerId,playerState=window.jwplayer(playerId).getState();playerState&&(opt.playerList[viewTypeName][playerIndex].isPlay=!1,window.jwplayer(playerId).pause(!0))}function playerPlay(viewTypeName,playerIndex){var opt=liveviewCtrl.data,playerId=opt.playerList[viewTypeName][playerIndex].playerId,playerState=window.jwplayer(playerId).getState();if(playerState){if("IDLE"===playerState)window.jwplayer(playerId).play(!0);else{var cameraData=opt.playerList[viewTypeName][playerIndex].cameraData;loadVideo(viewTypeName,playerIndex,cameraData)}opt.playerList[viewTypeName][playerIndex].isPlay=!0}}function playerFullScreen(viewTypeName,playerIndex,id){var fullScreenId=(liveviewCtrl.data,$(UtilsService.getFullScreenElement()).attr("id"));Fullscreen.isEnabled()&&fullScreenId===id?Fullscreen.cancel():Fullscreen.enable(document.getElementById(id))}function playerReflash(viewTypeName,playerIndex){var opt=liveviewCtrl.data,cameraData=(opt.playerList[viewTypeName][playerIndex].playerId,opt.playerList[viewTypeName][playerIndex].cameraData);loadVideo(viewTypeName,playerIndex,cameraData),opt.playerList[viewTypeName][playerIndex].isPlay=!0}function playerRemove(viewTypeName,playerIndex){var opt=liveviewCtrl.data,playerId=opt.playerList[viewTypeName][playerIndex].playerId,playerState=window.jwplayer(playerId).getState();playerState&&(window.jwplayer(playerId).remove(),$("#"+playerId).addClass("kupPlayer"),opt.playerList[viewTypeName][playerIndex]=null)}function playerSelected(viewTypeName,playerIndex){LiveviewService.playerSelected(viewTypeName,playerIndex)}function addTime(){var opt=liveviewCtrl.data;opt.autoRotationTime<opt.autoRotationTimeMax?opt.autoRotationTime++:opt.autoRotationTime=opt.autoRotationTimeMax}function subTime(){var opt=liveviewCtrl.data;opt.autoRotationTime>opt.autoRotationTimeMin?opt.autoRotationTime--:opt.autoRotationTime=opt.autoRotationTimeMin}function saveTime(){liveviewCtrl.data;autoRotation(),LiveviewService.saveUserPrefsApi()}function autoRotation(){var opt=liveviewCtrl.data,playerList=opt.playerList,autoRotation=opt.autoRotation,autoRotationTime=1e3*opt.autoRotationTime,autoLoadVideo=function(){$.each(playerList,function(type,player){return LiveviewService.getActiveViewType().name!==type||void $.each(player,function(i,info){return!(info&&info.isAssignCamera&&info.playerId&&!$.isEmptyObject(info.cameraData))||void loadVideo(type,i,info.cameraData)})})};disableRotation(),autoRotation&&(opt.autoRotationPromise=$interval(function(){autoLoadVideo()},autoRotationTime))}function disableRotation(){var opt=liveviewCtrl.data;opt.autoRotationPromise&&$interval.cancel(opt.autoRotationPromise)}var kupOpt=KupOption,i18n=UtilsService.i18n,notification=UtilsService.notification,mainCtrl=(UtilsService.block,$scope.$parent.mainCtrl),liveviewCtrl=this;window.jwplayer&&(window.jwplayer.key=kupOpt.jwplayerKey),liveviewCtrl.data=LiveviewService.data,liveviewCtrl.data.isfirefox=$("html").hasClass("k-ff"),liveviewCtrl.data.uiTreeview.options=getTreeviewOptions(),liveviewCtrl.data.uiDragTarget.options=getDragTargetOptions(),liveviewCtrl.fn={isEmptyDevice:DeviceTreeService.isEmptyDevice,showMainMenu:MainService.showMainMenu,fullScreen:fullScreen,setCurrectViewType:setCurrectViewType,setCurrectFilterVca:setCurrectFilterVca,getCurrectFilterVca:getCurrectFilterVca,getCountAry:getCountAry,getSelectedPlayer:getSelectedPlayer,playerHoverIn:playerHoverIn,playerHoverOut:playerHoverOut,playerPause:playerPause,playerPlay:playerPlay,playerReflash:playerReflash,playerFullScreen:playerFullScreen,playerRemove:playerRemove,playerSelected:playerSelected,addTime:addTime,subTime:subTime,saveTime:saveTime},init()}]);