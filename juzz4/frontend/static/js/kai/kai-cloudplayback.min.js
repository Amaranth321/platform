function kupInit(bucket,defaultErrorHandler){kupBucket=bucket,defaultErrorHandler&&(kupDefaultErrorHandler=defaultErrorHandler),"undefined"!=typeof kainode&&kainode.init(bucket,defaultErrorHandler),kupapi.timeZoneOffset=(new Date).getTimezoneOffset()*-1}function ajax(url,params,succFunc,failFunc,method,extra){return url=apiRootUrl+url,params["session-key"]=kupSessionKey,busyOverlayVisibility&&utils.showLoadingOverlay(),$.ajax({type:method,url:url,data:params,cache:!1,success:function(data){busyOverlayVisibility&&utils.hideLoadingOverlay(),null!=succFunc&&succFunc(data,extra)},error:function(jqXHR,status){busyOverlayVisibility&&utils.hideLoadingOverlay(),failFunc?failFunc(jqXHR,extra):kupDefaultErrorHandler&&kupDefaultErrorHandler(jqXHR,extra)}})}function ajaxPost(url,params,succFunc,failFunc,extra){return ajax(url,params,succFunc,failFunc,"POST",extra)}function sendGETRequest(paramMap,apiName){var link="/api/"+kupBucket+"/"+apiName+"?";$.each(paramMap,function(key,value){link+=key+"="+value+"&"}),link=utils.replaceAll(link,"-","%2D"),window.open(link,"_blank")}function requestDownloadUrl(url,params,onSuccess,onFailure){null==onSuccess&&(utils.showLoadingTextOverlay(localizeResource("generating-download-file"),!1),onSuccess=function(responseData){utils.hideLoadingOverlay(),null!=responseData&&"ok"==responseData.result&&null!=responseData["download-url"]?window.open(responseData["download-url"],"_blank"):utils.throwServerError(responseData)}),ajaxPost(url,params,onSuccess,onFailure)}function login(username,password,rememberSession,onSuccess,onFailure){var params={"user-name":username,password:password,"remember-me":rememberSession},url="/api/"+kupBucket+"/login";return ajaxPost(url,params,onSuccess,onFailure)}function logout(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/logout";return ajaxPost(url,params,onSuccess,onFailure)}function keepSessionAlive(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/keepalive";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketUsers(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getbucketusers";return ajaxPost(url,params,onSuccess,onFailure)}function getUserDevices(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getuserdevices";return ajaxPost(url,params,onSuccess,onFailure)}function getUserDevicesByUserId(userId,sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId},url="/api/"+kupBucket+"/getuserdevicesbyuserid";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketDevices(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getbucketdevices";return ajaxPost(url,params,onSuccess,onFailure)}function getUserMobileDevices(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getusermobiledevices";return ajaxPost(url,params,onSuccess,onFailure)}function removeMobileDeviceOfUser(sessionKey,identifier,onSuccess,onFailure){var params={"session-key":sessionKey,identifier:identifier},url="/api/"+kupBucket+"/removemobiledeviceofuser";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketDeviceLabels(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getbucketdevicelabels";return ajaxPost(url,params,onSuccess,onFailure)}function addDeviceToBucket(sessionKey,deviceDetails,onSuccess,onFailure){var params={"session-key":sessionKey,"registration-number":null==deviceDetails.regNumber?"":deviceDetails.regNumber,"device-name":deviceDetails.name,"model-id":deviceDetails.model,"device-key":deviceDetails.deviceKey,"device-host":deviceDetails.host,"device-port":deviceDetails.port,"device-login":deviceDetails.login,"device-password":deviceDetails.password,"device-address":deviceDetails.address,"device-latitude":deviceDetails.latitude,"device-longitude":deviceDetails.longitude,"cloud-recording-enabled":deviceDetails.cloudRecordingEnabled},url="/api/"+kupBucket+"/adddevicetobucket";return ajaxPost(url,params,onSuccess,onFailure)}function updateDevice(sessionKey,deviceDetails,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceDetails.id,"device-name":deviceDetails.name,"model-id":deviceDetails.model,"device-key":deviceDetails.deviceKey,"device-host":deviceDetails.host,"device-port":null!==deviceDetails.port?deviceDetails.port.toString():"","device-login":deviceDetails.login,"device-password":deviceDetails.password,"device-address":deviceDetails.address,"device-latitude":deviceDetails.latitude,"device-longitude":deviceDetails.longitude,"cloud-recording-enabled":deviceDetails.cloudRecordingEnabled},url="/api/"+kupBucket+"/updatedevice";return ajaxPost(url,params,onSuccess,onFailure)}function removeDeviceFromBucket(sessionKey,deviceId,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId},url="/api/"+kupBucket+"/removedevicefrombucket";return ajaxPost(url,params,onSuccess,onFailure)}function addDeviceUser(sessionKey,deviceId,userId,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"user-id":userId},url="/api/"+kupBucket+"/adddeviceuser";return ajaxPost(url,params,onSuccess,onFailure)}function removeDeviceUser(sessionKey,deviceId,userId,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"user-id":userId},url="/api/"+kupBucket+"/removedeviceuser";return ajaxPost(url,params,onSuccess,onFailure)}function getLiveVideoUrl(sessionKey,deviceId,channelId,streamType,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,"stream-type":streamType},url="/api/"+kupBucket+"/getlivevideourl";return ajaxPost(url,params,onSuccess,onFailure)}function keepAliveLiveVideoUrl(sessionKey,streamingSessionKey,onSuccess,onFailure){var params={"session-key":sessionKey,"streaming-session-key":streamingSessionKey},url="/api/"+kupBucket+"/keepalivelivevideourl";return ajaxPost(url,params,onSuccess,onFailure)}function expireLiveVideoUrl(sessionKey,streamingSessionKey,onSuccess,onFailure){var params={"session-key":sessionKey,"streaming-session-key":streamingSessionKey},url="/api/"+kupBucket+"/expirelivevideourl";return ajaxPost(url,params,onSuccess,onFailure)}function getPlaybackVideoUrl(deviceId,channelId,streamType,from,to,ttlSeconds,onSuccess,onFailure){var params={"device-id":deviceId,"channel-id":channelId,"stream-type":streamType,from:from,to:to,"ttl-seconds":ttlSeconds},url="/api/"+kupBucket+"/getplaybackvideourl";return ajaxPost(url,params,onSuccess,onFailure)}function keepAlivePlaybackVideoUrl(sessionKey,streamingSessionKey,onSuccess,onFailure){var params={"session-key":sessionKey,"streaming-session-key":streamingSessionKey},url="/api/"+kupBucket+"/keepaliveplaybackvideourl";return ajaxPost(url,params,onSuccess,onFailure)}function expirePlaybackVideoUrl(streamingSessionKey,onSuccess,onFailure){var params={"streaming-session-key":streamingSessionKey},url="/api/"+kupBucket+"/expireplaybackvideourl";return ajaxPost(url,params,onSuccess,onFailure)}function getDashboard(days,timeZone,onSuccess,onFailure){var params={days:days,"time-zone-offset":timeZone},url="/api/"+kupBucket+"/getdashboard";return ajaxPost(url,params,onSuccess,onFailure)}function getAllEvents(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getallevents";return ajaxPost(url,params,onSuccess,onFailure)}function getEvents(sessionKey,eventType,eventId,skip,take,deviceId,channelId,from,to,bound,radius,fields,onSuccess,onFailure){var params={"session-key":sessionKey,"event-type":eventType==KupEvent.ALL?KupEvent.ALL:eventType.toString(),"event-id":eventId,skip:skip,take:take,"device-id":deviceId,bound:null==bound?bound:bound.toString(),rad:radius,"channel-id":channelId,from:from,to:to,fields:fields},url="/api/"+kupBucket+"/getevents";return ajaxPost(url,params,onSuccess,onFailure)}function getEventsWithBinary(eventType,skip,take,deviceId,channelId,from,to,onSuccess,onFailure){var params={"event-type":eventType==KupEvent.ALL?KupEvent.ALL:eventType.toString(),skip:skip,take:take,"device-id":deviceId,"channel-id":channelId,from:from,to:to},url="/api/"+kupBucket+"/geteventswithbinary";return ajaxPost(url,params,onSuccess,onFailure)}function forgotPassword(username,email,bucket,onSuccess,onFailure){var params={"user-name":username,email:email,bucket:bucket},url="/api/forgotpassword";return ajaxPost(url,params,onSuccess,onFailure)}function resetPasswordWithKey(key,password,onSuccess,onFailure){var params={key:key,password:password},url="/api/resetpasswordwithkey";return ajaxPost(url,params,onSuccess,onFailure)}function isUsernameAvailable(sessionKey,username,onSuccess,onFailure){var params={"session-key":sessionKey,"user-name":username},url="/api/"+kupBucket+"/isusernameavailable";return ajaxPost(url,params,onSuccess,onFailure)}function addUser(sessionKey,name,username,email,phone,labels,password,onSuccess,onFailure){var params={"session-key":sessionKey,name:name,"user-name":username,email:email,phone:phone,labels:labels,password:password},url="/api/"+kupBucket+"/adduser";return ajaxPost(url,params,onSuccess,onFailure)}function updateUser(sessionKey,userId,name,username,email,phone,labels,password,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId,name:name,"user-name":username,email:email,phone:phone,labels:labels,password:password},url="/api/"+kupBucket+"/updateuser";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketUserLabels(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getbucketuserlabels";return ajaxPost(url,params,onSuccess,onFailure)}function activateBucket(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/activatebucket";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateBucket(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/deactivatebucket";return ajaxPost(url,params,onSuccess,onFailure)}function activateUser(sessionKey,userId,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId},url="/api/"+kupBucket+"/activateuser";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateUser(sessionKey,userId,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId},url="/api/"+kupBucket+"/deactivateuser";return ajaxPost(url,params,onSuccess,onFailure)}function removeUser(sessionKey,userId,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId},url="/api/"+kupBucket+"/removeuser";return ajaxPost(url,params,onSuccess,onFailure)}function receiveCometNotification(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/recvcometnotification";return ajaxPost(url,params,onSuccess,onFailure)}function updateUserProfile(sessionKey,name,username,email,phone,language,onSuccess,onFailure){var params={"session-key":sessionKey,name:name,"user-name":username,email:email,phone:phone,language:language},url="/api/"+kupBucket+"/updateuserprofile";return ajaxPost(url,params,onSuccess,onFailure)}function changePassword(sessionKey,oldPassword,newPassword,onSuccess,onFailure){var params={"session-key":sessionKey,"old-password":oldPassword,"new-password":newPassword},url="/api/"+kupBucket+"/changepassword";return ajaxPost(url,params,onSuccess,onFailure)}function getDeviceModels(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getdevicemodels";return ajaxPost(url,params,onSuccess,onFailure)}function getUserPrefs(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getuserprefs";return ajaxPost(url,params,onSuccess,onFailure)}function getInventoryList(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getinventorylist";return ajaxPost(url,params,onSuccess,onFailure)}function updateInventory(sessionKey,viewModel,onSuccess,onFailure){var params={"session-key":sessionKey,"inventory-id":viewModel.id,"registration-name":viewModel.registrationName,"model-number":viewModel.modelNumber,"mac-address":viewModel.macAddress},url="/api/"+kupBucket+"/updateinventory";return ajaxPost(url,params,onSuccess,onFailure)}function saveUserprefs(sessionKey,slotSettings,duration,autorotation,autorotationtime,fakeposdatapref,onSuccess,onFailure){var params={"session-key":sessionKey,"slot-settings":JSON.stringify(slotSettings),duration:duration,"auto-rotation":autorotation,"auto-rotation-time":autorotationtime,"fake-pos-data-pref":fakeposdatapref},url="/api/"+kupBucket+"/saveuserprefs";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketRoles(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getbucketroles";return ajaxPost(url,params,onSuccess,onFailure)}function addBucketRole(sessionKey,roleName,description,onSuccess,onFailure){var params={"session-key":sessionKey,"role-name":roleName,description:description},url="/api/"+kupBucket+"/addbucketrole";return ajaxPost(url,params,onSuccess,onFailure)}function editBucketRole(sessionKey,roleId,name,description,onSuccess,onFailure){var params={"session-key":sessionKey,"role-id":roleId,"role-name":name,"role-description":description},url="/api/"+kupBucket+"/editbucketrole";return ajaxPost(url,params,onSuccess,onFailure)}function removeRole(sessionKey,roleId,onSuccess,onFailure){var params={"session-key":sessionKey,"role-id":roleId},url="/api/"+kupBucket+"/removerole";return ajaxPost(url,params,onSuccess,onFailure)}function getRoleFeatures(sessionKey,roleId,onSuccess,onFailure){var params={"session-key":sessionKey,"role-id":roleId},url="/api/"+kupBucket+"/getrolefeatures";return ajaxPost(url,params,onSuccess,onFailure)}function updateRoleFeatures(sessionKey,roleId,featureAssignments,onSuccess,onFailure){var params={"session-key":sessionKey,"role-id":roleId,"feature-assignments":featureAssignments},url="/api/"+kupBucket+"/updaterolefeatures";return ajaxPost(url,params,onSuccess,onFailure)}function getUserFeatures(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getuserfeatures";return ajaxPost(url,params,onSuccess,onFailure)}function getUserRolesByUserId(sessionKey,userId,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId},url="/api/"+kupBucket+"/getuserrolesbyuserid";return ajaxPost(url,params,onSuccess,onFailure)}function updateUserRoles(sessionKey,userId,roleAssignments,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId,"role-assignments":roleAssignments},url="/api/"+kupBucket+"/updateuserroles";return ajaxPost(url,params,onSuccess,onFailure)}function addVehicleUser(sessionKey,userId,vehicleId,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId,"vehicle-id":vehicleId},url="/api/"+kupBucket+"/addvehicleuser";return ajaxPost(url,params,onSuccess,onFailure)}function removeVehicleUser(sessionKey,userId,vehicleId,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId,"vehicle-id":vehicleId},url="/api/"+kupBucket+"/removevehicleuser";return ajaxPost(url,params,onSuccess,onFailure)}function getUserVehicles(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getuservehicles";return ajaxPost(url,params,onSuccess,onFailure)}function getUserVehiclesByUserId(sessionKey,userId,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId},url="/api/"+kupBucket+"/getuservehiclesbyuserid";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketPois(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getbucketpois";return ajaxPost(url,params,onSuccess,onFailure)}function addPoi(sessionKey,poi,onSuccess,onFailure){var params={"session-key":sessionKey,name:poi.name,type:poi.type,address:poi.address,latitude:poi.latitude,longitude:poi.longitude,description:poi.description},url="/api/"+kupBucket+"/addpoi";return ajaxPost(url,params,onSuccess,onFailure)}function updatePoi(sessionKey,poi,onSuccess,onFailure){var params={"session-key":sessionKey,id:poi.id,name:poi.name,type:poi.type,address:poi.address,latitude:poi.latitude,longitude:poi.longitude,description:poi.description},url="/api/"+kupBucket+"/updatepoi";return ajaxPost(url,params,onSuccess,onFailure)}function removePoi(sessionKey,poiId,onSuccess,onFailure){var params={"session-key":sessionKey,"poi-id":poiId},url="/api/"+kupBucket+"/removepoi";return ajaxPost(url,params,onSuccess,onFailure)}function getBuckets(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getbuckets";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketsPlusDeleted(sessionKey,showDeleted,onSuccess,onFailure){var params={"session-key":sessionKey,"show-deleted":showDeleted},url="/api/"+kupBucket+"/getbuckets";return ajaxPost(url,params,onSuccess,onFailure)}function addBucket(sessionKey,bucket,onSuccess,onFailure){var params={"session-key":sessionKey,"parent-bucket-id":bucket.parentId,"bucket-name":bucket.name,"bucket-path":bucket.path,"bucket-description":bucket.description},url="/api/"+kupBucket+"/addbucket";return ajaxPost(url,params,onSuccess,onFailure)}function updateBucket(sessionKey,bucket,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucket.id,"parent-bucket-id":bucket.parentId,"bucket-name":bucket.name,"bucket-path":bucket.path,"bucket-description":bucket.description},url="/api/"+kupBucket+"/updatebucket";return ajaxPost(url,params,onSuccess,onFailure)}function removeBucket(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/removebucket";return ajaxPost(url,params,onSuccess,onFailure)}function restoreBucket(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/restorebucket";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketLogs(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/getbucketlogs";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketFeatures(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/getbucketfeatures";return ajaxPost(url,params,onSuccess,onFailure)}function updateBucketFeatures(sessionKey,bucketId,featureAssignments,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId,"feature-assignments":featureAssignments},url="/api/"+kupBucket+"/updatebucketfeatures";return ajaxPost(url,params,onSuccess,onFailure)}function removeAllInventory(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/removeallinventory";return ajaxPost(url,params,onSuccess,onFailure)}function removeInventory(sessionKey,inventoryId,onSuccess,onFailure){var params={"session-key":sessionKey,"inventory-id":inventoryId},url="/api/"+kupBucket+"/removeinventory";return ajaxPost(url,params,onSuccess,onFailure)}function getEventBinaryData(eventId,onSuccess,onFailure){var params={"event-id":eventId},url="/api/"+kupBucket+"/geteventbinarydata";return ajaxPost(url,params,onSuccess,onFailure)}function exportDataLogs(fileFormat,eventType,deviceId,channelId,from,to,onSuccess,onFailure){var params={"file-format":fileFormat,"event-type":eventType,from:from,to:to,"time-zone-offset":kupapi.timeZoneOffset,"device-id":deviceId,"channel-id":channelId},url="/api/"+kupBucket+"/exportdatalogs";requestDownloadUrl(url,params,onSuccess,onFailure)}function addAreaIntrusion(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addareaintrusion";return ajaxPost(url,params,onSuccess,onFailure)}function updateAreaIntrusion(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updateareaintrusion";return ajaxPost(url,params,onSuccess,onFailure)}function removeAreaIntrusion(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removeareaintrusion";return ajaxPost(url,params,onSuccess,onFailure)}function activateAreaIntrusion(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activateareaintrusion";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateAreaIntrusion(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivateareaintrusion";return ajaxPost(url,params,onSuccess,onFailure)}function addPerimeterDefense(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addperimeterdefense";return ajaxPost(url,params,onSuccess,onFailure)}function updatePerimeterDefense(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updateperimeterdefense";return ajaxPost(url,params,onSuccess,onFailure)}function removePerimeterDefense(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removeperimeterdefense";return ajaxPost(url,params,onSuccess,onFailure)}function activatePerimeterDefense(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activateperimeterdefense";return ajaxPost(url,params,onSuccess,onFailure)}function deactivatePerimeterDefense(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivateperimeterdefense";return ajaxPost(url,params,onSuccess,onFailure)}function addAreaLoitering(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addarealoitering";return ajaxPost(url,params,onSuccess,onFailure)}function updateAreaLoitering(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updatearealoitering";return ajaxPost(url,params,onSuccess,onFailure)}function removeAreaLoitering(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removearealoitering";return ajaxPost(url,params,onSuccess,onFailure)}function activateAreaLoitering(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activatearealoitering";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateAreaLoitering(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivatearealoitering";return ajaxPost(url,params,onSuccess,onFailure)}function addObjectCounting(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addobjectcounting";return ajaxPost(url,params,onSuccess,onFailure)}function updateObjectCounting(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updateobjectcounting";return ajaxPost(url,params,onSuccess,onFailure)}function removeObjectCounting(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removeobjectcounting";return ajaxPost(url,params,onSuccess,onFailure)}function activateObjectCounting(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activateobjectcounting";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateObjectCounting(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivateobjectcounting";return ajaxPost(url,params,onSuccess,onFailure)}function addVideoBlur(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addvideoblur";return ajaxPost(url,params,onSuccess,onFailure)}function updateVideoBlur(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updatevideoblur";return ajaxPost(url,params,onSuccess,onFailure)}function removeVideoBlur(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removevideoblur";return ajaxPost(url,params,onSuccess,onFailure)}function activateVideoBlur(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activatevideoblur";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateVideoBlur(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivatevideoblur";return ajaxPost(url,params,onSuccess,onFailure)}function addFaceIndexing(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addfaceindexing";return ajaxPost(url,params,onSuccess,onFailure)}function updateFaceIndexing(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updatefaceindexing";return ajaxPost(url,params,onSuccess,onFailure)}function removeFaceIndexing(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removefaceindexing";return ajaxPost(url,params,onSuccess,onFailure)}function activateFaceIndexing(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activatefaceindexing";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateFaceIndexing(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivatefaceindexing";return ajaxPost(url,params,onSuccess,onFailure)}function addTrafficFlow(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addtrafficflow";return ajaxPost(url,params,onSuccess,onFailure)}function updateTrafficFlow(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updatetrafficflow";return ajaxPost(url,params,onSuccess,onFailure)}function removeTrafficFlow(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removetrafficflow";return ajaxPost(url,params,onSuccess,onFailure)}function activateTrafficFlow(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activatetrafficflow";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateTrafficFlow(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivatetrafficflow";return ajaxPost(url,params,onSuccess,onFailure)}function addPeopleCounting(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addpeoplecounting";return ajaxPost(url,params,onSuccess,onFailure)}function updatePeopleCounting(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updatepeoplecounting";return ajaxPost(url,params,onSuccess,onFailure)}function removePeopleCounting(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removepeoplecounting";return ajaxPost(url,params,onSuccess,onFailure)}function activatePeopleCounting(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activatepeoplecounting";return ajaxPost(url,params,onSuccess,onFailure)}function deactivatePeopleCounting(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivatepeoplecounting";return ajaxPost(url,params,onSuccess,onFailure)}function addCrowdDetection(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addcrowddetection";return ajaxPost(url,params,onSuccess,onFailure)}function updateCrowdDetection(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,
thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updatecrowddetection";return ajaxPost(url,params,onSuccess,onFailure)}function removeCrowdDetection(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removecrowddetection";return ajaxPost(url,params,onSuccess,onFailure)}function activateCrowdDetection(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activatecrowddetection";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateCrowdDetection(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivatecrowddetection";return ajaxPost(url,params,onSuccess,onFailure)}function addAudienceProfiling(sessionKey,deviceId,channelId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addaudienceprofiling";return ajaxPost(url,params,onSuccess,onFailure)}function updateAudienceProfiling(sessionKey,instanceId,thresholds,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,thresholds:thresholds,"recurrence-rule":utils.isNullOrEmpty(recurrenceRule)?"":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/updateaudienceprofiling";return ajaxPost(url,params,onSuccess,onFailure)}function removeAudienceProfiling(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/removeaudienceprofiling";return ajaxPost(url,params,onSuccess,onFailure)}function activateAudienceProfiling(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/activateaudienceprofiling";return ajaxPost(url,params,onSuccess,onFailure)}function deactivateAudienceProfiling(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/deactivateaudienceprofiling";return ajaxPost(url,params,onSuccess,onFailure)}function getVcaCommands(sessionKey,instanceId,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId},url="/api/"+kupBucket+"/getvcacommands";return ajaxPost(url,params,onSuccess,onFailure)}function setVcaCommands(sessionKey,instanceId,paramString,onSuccess,onFailure){var params={"session-key":sessionKey,"instance-id":instanceId,"param-string":paramString},url="/api/"+kupBucket+"/setvcacommands";return ajaxPost(url,params,onSuccess,onFailure)}function listRunningAnalytics(sessionKey,analyticsType,onSuccess,onFailure){var params={"session-key":sessionKey,"analytics-type":analyticsType},url="/api/"+kupBucket+"/listrunninganalytics";return ajaxPost(url,params,onSuccess,onFailure)}function updateBucketSettings(sessionKey,bucketSetting,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketSetting.bucketId,"max-vca-count":bucketSetting.maxvcacount,"bucket-userlimit":bucketSetting.userLimit,"email-verification-of-users":bucketSetting.emailverificationofusersenabled,"custom-logo":bucketSetting.customLogo,"binary-data":bucketSetting.binaryData,"map-source":bucketSetting.mapSource},url="/api/"+kupBucket+"/updatebucketsettings";return ajaxPost(url,params,onSuccess,onFailure)}function exportVcaSecurityPdf(svgString,reportInfo,onSuccess,onFailure){var params={"time-zone-offset":kupapi.timeZoneOffset,"svg-string":svgString,"report-info":reportInfo},url="/api/"+kupBucket+"/exportvcasecuritypdf";requestDownloadUrl(url,params,onSuccess,onFailure)}function exportPeopleCountingPdf(svgString,reportInfo,onSuccess,onFailure){var params={"time-zone-offset":kupapi.timeZoneOffset,"svg-string":svgString,"report-info":reportInfo},url="/api/"+kupBucket+"/exportpeoplecountingpdf";requestDownloadUrl(url,params,onSuccess,onFailure)}function exportProfilingChartReport(svgString1,svgString2,reportInfo,onSuccess,onFailure){var params={"time-zone-offset":kupapi.timeZoneOffset,"svg-string1":svgString1.toString(),"svg-string2":svgString2.toString(),"report-info":reportInfo},url="/api/"+kupBucket+"/exportaudienceprofilingpdf";requestDownloadUrl(url,params,onSuccess,onFailure)}function exportFaceIndexingReport(svgString,reportInfo,eventIdList,onSuccess,onFailure){var params={"time-zone-offset":kupapi.timeZoneOffset,"svg-string":svgString,"report-info":reportInfo,"event-ids":eventIdList},url="/api/"+kupBucket+"/exportfaceindexingpdf";requestDownloadUrl(url,params,onSuccess,onFailure)}function exportTrafficFlowPdf(base64Image,reportInfo,onSuccess,onFailure){var params={"time-zone-offset":kupapi.timeZoneOffset,"base64-image":base64Image,"report-info":reportInfo},url="/api/"+kupBucket+"/exporttrafficflowpdf";requestDownloadUrl(url,params,onSuccess,onFailure)}function exportCrowdReport(sessionKey,deviceId,channelId,base64Image,base64RegionImage,svgImage,reportInfo,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,"time-zone-offset":kupapi.timeZoneOffset,"base64-image":base64Image,"base64-region-image":base64RegionImage,"svg-image":svgImage,"report-info":reportInfo},url="/api/"+kupBucket+"/exportcrowddensitypdf";requestDownloadUrl(url,params,onSuccess,onFailure)}function generateSyncFile(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/generatesyncfile";return ajaxPost(url,params,onSuccess,onFailure)}function getSoftwareUpdateList(sessionKey,onSuccess,onFailure){var params={},url="/api/"+kupBucket+"/getsoftwareupdatelist";return ajaxPost(url,params,onSuccess,onFailure)}function updateNodeSoftware(nodePlatformId,onSuccess,onFailure){var params={"node-id":nodePlatformId},url="/api/"+kupBucket+"/updatenodesoftware";return ajaxPost(url,params,onSuccess,onFailure)}function removeSoftwareUpdate(sessionKey,fileServerId,onSuccess,onFailure){var params={"session-key":sessionKey,"file-server-id":fileServerId},url="/api/"+kupBucket+"/removesoftwareupdate";return ajaxPost(url,params,onSuccess,onFailure)}function downloadSoftwareUpdate(sessionKey,fileName){window.location.href="/api/"+kupBucket+"/downloadsoftwareupdate/"+fileName}function exportuserlist(){var params={},url="/api/"+kupBucket+"/exportuserlist";requestDownloadUrl(url,params)}function getAccessKeyList(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getaccesskeylist";return ajaxPost(url,params,onSuccess,onFailure)}function generateAccessKey(sessionKey,userId,ttl,maxUseCount,onSuccess,onFailure){var params={"session-key":sessionKey,"user-id":userId,ttl:ttl,"max-use-count":maxUseCount},url="/api/"+kupBucket+"/generateaccesskey";return ajaxPost(url,params,onSuccess,onFailure)}function removeAccessKey(sessionKey,key,onSuccess,onFailure){var params={"session-key":sessionKey,key:key},url="/api/"+kupBucket+"/removeaccesskey";return ajaxPost(url,params,onSuccess,onFailure)}function otpLogin(otp,onSuccess,onFailure){var params={otp:otp},url="/api/otplogin";return ajaxPost(url,params,onSuccess,onFailure)}function getAnnouncementList(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey};if(""!=kupBucket)var url="/api/"+kupBucket+"/getannouncementlist";else var url="/api/superadmin/getannouncementlist";return ajaxPost(url,params,onSuccess,onFailure)}function addAnnouncement(sessionKey,viewModel,onSuccess,onFailure){var params={"session-key":sessionKey,"announcement-type":viewModel.type,description:viewModel.description,domain:viewModel.domain},url="/api/"+kupBucket+"/addannouncement";return ajaxPost(url,params,onSuccess,onFailure)}function updateAnnouncement(sessionKey,viewModel,onSuccess,onFailure){var params={"session-key":sessionKey,"announcement-id":viewModel.id,"announcement-type":viewModel.type,description:viewModel.description,domain:viewModel.domain},url="/api/"+kupBucket+"/updateannouncement";return ajaxPost(url,params,onSuccess,onFailure)}function removeAnnouncement(sessionKey,id,onSuccess,onFailure){var params={"session-key":sessionKey,"announcement-id":id},url="/api/"+kupBucket+"/removeannouncement";return ajaxPost(url,params,onSuccess,onFailure)}function getAlerts(sessionKey,eventId,eventType,skip,take,deviceId,channelId,from,to,onSuccess,onFailure){var params={"session-key":sessionKey,"event-id":eventId,"event-type":eventType,skip:skip,take:take,"device-id":deviceId,"channel-id":channelId,from:from,to:to},url="/api/"+kupBucket+"/getalerts";return ajaxPost(url,params,onSuccess,onFailure)}function exportAlerts(fileFormat,deviceId,channelId,eventType,from,to){var params={"file-format":fileFormat,"time-zone-offset":kupapi.timeZoneOffset,"device-id":deviceId,"channel-id":channelId,"event-type":eventType,from:from,to:to},url="/api/"+kupBucket+"/exportalerts";requestDownloadUrl(url,params)}function getAuditLog(sessionKey,bucketName,userName,serviceName,remoteIp,skip,take,start,end,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-name":bucketName,"user-name":userName,"service-name":serviceName,"remote-ip":remoteIp,skip:skip,take:take,from:start,to:end},url="/api/"+kupBucket+"/getauditlog";return ajaxPost(url,params,onSuccess,onFailure)}function getAuditLogDetails(sessionKey,auditId,onSuccess,onFailure){var params={"session-key":sessionKey,"audit-id":auditId},url="/api/"+kupBucket+"/getauditlogdetails";return ajaxPost(url,params,onSuccess,onFailure)}function exportAuditLog(fileFormat,bucketName,userName,serviceName,remoteIp,skip,take,start,end){var params={"file-format":fileFormat,"time-zone-offset":kupapi.timeZoneOffset,"bucket-name":bucketName,"user-name":userName,"service-name":serviceName,"remote-ip":remoteIp,skip:skip,take:take,from:start,to:end},url="/api/"+kupBucket+"/exportauditlog";requestDownloadUrl(url,params)}function addSchedulePreset(sessionKey,name,recurrenceRule,onSuccess,onFailure){var params={"session-key":sessionKey,name:name,"recurrence-rule":JSON.stringify(recurrenceRule)},url="/api/"+kupBucket+"/addschedulepreset";return ajaxPost(url,params,onSuccess,onFailure)}function getSchedulePresets(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getschedulepresets";return ajaxPost(url,params,onSuccess,onFailure)}function removeSchedulePreset(sessionKey,presetId,onSuccess,onFailure){var params={"session-key":sessionKey,"preset-id":presetId},url="/api/"+kupBucket+"/removeschedulepreset";return ajaxPost(url,params,onSuccess,onFailure)}function startRemoteShell(sessionKey,deviceId,host,port,username,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,host:host,port:port,"user-name":username},url="/api/"+kupBucket+"/startremoteshell";return ajaxPost(url,params,onSuccess,onFailure)}function startRemoteShell(sessionKey,deviceId,host,port,username,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,host:host,port:port,"user-name":username},url="/api/"+kupBucket+"/startremoteshell";return ajaxPost(url,params,onSuccess,onFailure)}function stopRemoteShell(sessionKey,deviceId,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId},url="/api/"+kupBucket+"/stopremoteshell";return ajaxPost(url,params,onSuccess,onFailure)}function getRemoteShellList(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/getremoteshelllist";return ajaxPost(url,params,onSuccess,onFailure)}function editNodeCamera(sessionKey,nodeId,updatedCamera,onSuccess,onFailure){var params={"session-key":sessionKey,"node-id":nodeId,"node-camera-id":updatedCamera.nodePlatformDeviceId,"camera-name":updatedCamera.name,"device-key":updatedCamera.deviceKey,host:updatedCamera.host,port:updatedCamera.port,login:updatedCamera.login,password:updatedCamera.password,address:updatedCamera.address,latitude:updatedCamera.latitude,longitude:updatedCamera.longitude,cloudRecordingEnabled:updatedCamera.cloudRecordingEnabled,labels:JSON.stringify(updatedCamera.labels)},url="/api/"+kupBucket+"/editnodecamera";return ajaxPost(url,params,onSuccess,onFailure)}function startAutoDiscovery(sessionKey,modelId,onSuccess,onFailure){var params={"session-key":sessionKey,"model-id":modelId},url="/api/"+kupBucket+"/startautodiscovery";return ajaxPost(url,params,onSuccess,onFailure)}function stopAutoDiscovery(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/stopautodiscovery";return ajaxPost(url,params,onSuccess,onFailure)}function getDiscoveredDevices(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getdiscovereddevices";return ajaxPost(url,params,onSuccess,onFailure)}function getNodeLicenses(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/getnodelicenses";return ajaxPost(url,params,onSuccess,onFailure)}function addNodeLicense(sessionKey,bucketId,durationMonths,cloudStorageGb,maxVcaCount,featureNameList,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId,"duration-months":durationMonths,"cloud-storage-gb":cloudStorageGb,"max-vca-count":maxVcaCount,features:JSON.stringify(featureNameList)},url="/api/"+kupBucket+"/addnodelicense";return ajaxPost(url,params,onSuccess,onFailure)}function updateNodeLicense(sessionKey,licenseNumber,durationMonths,cloudStorageGb,maxVcaCount,featureNameList,onSuccess,onFailure){var params={"session-key":sessionKey,"license-number":licenseNumber,"duration-months":durationMonths,"cloud-storage-gb":cloudStorageGb,"max-vca-count":maxVcaCount,features:JSON.stringify(featureNameList)},url="/api/"+kupBucket+"/updatenodelicense";return ajaxPost(url,params,onSuccess,onFailure)}function deleteNodeLicense(sessionKey,licenseNumber,onSuccess,onFailure){var params={"session-key":sessionKey,"license-number":licenseNumber},url="/api/"+kupBucket+"/deletenodelicense";return ajaxPost(url,params,onSuccess,onFailure)}function suspendNodeLicense(sessionKey,licenseNumber,onSuccess,onFailure){var params={"session-key":sessionKey,"license-number":licenseNumber},url="/api/"+kupBucket+"/suspendnodelicense";return ajaxPost(url,params,onSuccess,onFailure)}function unsuspendNodeLicense(sessionKey,licenseNumber,onSuccess,onFailure){var params={"session-key":sessionKey,"license-number":licenseNumber},url="/api/"+kupBucket+"/unsuspendnodelicense";return ajaxPost(url,params,onSuccess,onFailure)}function getNodeLicenseLogs(sessionKey,licenseNumber,onSuccess,onFailure){var params={"session-key":sessionKey,"license-number":licenseNumber},url="/api/"+kupBucket+"/getnodelicenselogs";return ajaxPost(url,params,onSuccess,onFailure)}function getNodeLogList(sessionKey,bucketId,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId},url="/api/"+kupBucket+"/getnodeloglist";return ajaxPost(url,params,onSuccess,onFailure)}function pullLogFromNode(sessionKey,nodeId,onSuccess,onFailure){var params={"session-key":sessionKey,"node-id":nodeId},url="/api/"+kupBucket+"/pullnodelog";return ajaxPost(url,params,onSuccess,onFailure)}function downloadNodeLogFile(sessionKey,filename){window.location.href="/api/downloadnodelogfile/"+filename}function getNodeSettings(sessionKey,nodeCloudPlatformId,onSuccess,onFailure){var params={"session-key":sessionKey,"node-id":nodeCloudPlatformId},url="/api/"+kupBucket+"/getnodesettings";return ajaxPost(url,params,onSuccess,onFailure)}function getNodeCameraList(sessionKey,nodeCloudPlatformId,onSuccess,onFailure){var params={"session-key":sessionKey,"node-id":nodeCloudPlatformId},url="/api/"+kupBucket+"/getnodecameralist";return ajaxPost(url,params,onSuccess,onFailure)}function getNodeAnalyticsList(sessionKey,nodeCloudPlatformId,onSuccess,onFailure){var params={"session-key":sessionKey,"node-id":nodeCloudPlatformId},url="/api/"+kupBucket+"/getnodeanalyticslist";return ajaxPost(url,params,onSuccess,onFailure)}function getAnalyticsReport(sessionKey,eventType,deviceGroups,deviceId,channelId,from,to,parameters,onSuccess,onFailure){var params={"session-key":sessionKey,"event-type":eventType,"device-groups":deviceGroups?JSON.stringify(deviceGroups):"","device-id":deviceId,"channel-id":channelId,from:from,to:to,parameters:parameters?JSON.stringify(parameters):""},url="/api/"+kupBucket+"/getanalyticsreport";return ajaxPost(url,params,onSuccess,onFailure)}function exportProfilingCrossSiteXls(sessionKey,deviceId,channelId,fromDate,toDate,baseUnit,reportInfo,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId.toString(),"channel-id":channelId.toString(),"time-zone-offset":kupapi.timeZoneOffset,from:fromDate,to:toDate,"base-unit":baseUnit,"report-info":reportInfo},url="/api/"+kupBucket+"/exportprofilingcrosssitexls";return ajaxPost(url,params,onSuccess,onFailure)}function getPosSalesReport(sessionKey,from,to,name,parserType,onSuccess,onFailure){var params={"session-key":sessionKey,from:from,to:to,name:name,"parser-type":parserType},url="/api/"+kupBucket+"/getpossalesreport";return ajaxPost(url,params,onSuccess,onFailure)}function listPosNames(sessionKey,parserType,onSuccess,onFailure){var params={"session-key":sessionKey,"parser-type":parserType},url="/api/"+kupBucket+"/listposnames";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketDevicesByBucketId(bucketId,onSuccess,onFailure){var params={"bucket-id":bucketId},url="/api/"+kupBucket+"/getbucketdevicesbybucketid";return ajaxPost(url,params,onSuccess,onFailure)}function exportLicenseList(fileFormat,bucketId,status,registrationNumber,deviceName){var params={"file-format":fileFormat,"bucket-id":bucketId,status:status,"registration-number":registrationNumber,"device-name":deviceName},url="/api/"+kupBucket+"/exportlicenselist";requestDownloadUrl(url,params)}function getBucketUsersByBucketId(bucketId,onSuccess,onFailure){var params={bucketid:bucketId},url="/api/"+kupBucket+"/getbucketusersbybucketid";return ajaxPost(url,params,onSuccess,onFailure)}function exportUsersFileByBucketId(bucketId,fileFormat){var params={"bucket-id":bucketId,"file-format":fileFormat},url="/api/"+kupBucket+"/exportusersfilebybucketid";requestDownloadUrl(url,params)}function exportNodesFileByBucketId(bucketId,fileFormat){var params={"bucket-id":bucketId,"file-format":fileFormat,"time-zone-offset":kupapi.timeZoneOffset},url="/api/"+kupBucket+"/exportnodesbybucketid";requestDownloadUrl(url,params)}function reverseGeocode(address,onSuccess,onFailure){var params={address:address},url="/api/reversegeocode";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketLabels(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/api/"+kupBucket+"/getbucketlabels";return ajaxPost(url,params,onSuccess,onFailure)}function addBucketLabel(sessionKey,labelName,onSuccess,onFailure){var params={"session-key":sessionKey,"label-name":labelName},url="/api/"+kupBucket+"/addbucketlabel";return ajaxPost(url,params,onSuccess,onFailure)}function removeBucketLabel(sessionKey,labelName,onSuccess,onFailure){var params={"session-key":sessionKey,"label-name":labelName},url="/api/"+kupBucket+"/removebucketlabel";return ajaxPost(url,params,onSuccess,onFailure)}function unassignDeviceLabel(sessionKey,deviceId,labelName,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"label-name":labelName},url="/api/"+kupBucket+"/unassigndevicelabel";return ajaxPost(url,params,onSuccess,onFailure)}function unassignNodeCameraLabel(sessionKey,deviceId,channelId,labelName,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,"label-name":labelName},url="/api/"+kupBucket+"/unassignnodecameralabel";return ajaxPost(url,params,onSuccess,onFailure)}function assignDeviceLabel(sessionKey,deviceId,labelName,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"label-name":labelName},url="/api/"+kupBucket+"/assigndevicelabel";return ajaxPost(url,params,onSuccess,onFailure)}function assignNodeCameraLabel(sessionKey,deviceId,channelId,labelName,onSuccess,onFailure){var params={"session-key":sessionKey,"device-id":deviceId,"channel-id":channelId,"label-name":labelName},url="/api/"+kupBucket+"/assignnodecameralabel";return ajaxPost(url,params,onSuccess,onFailure)}function updatePOSSalesData(sessionKey,params,POSJSONString,onSuccess,onFailure){var params={"session-key":sessionKey,POSName:params.siteName,from:params.startDateStr,to:params.endDateStr,POSData:POSJSONString},url="/api/"+kupBucket+"/updatepossalesdata";return ajaxPost(url,params,onSuccess,onFailure)}function getNetworkStatus(sessionKey,onSuccess,onFailure){var params={"session-key":sessionKey},url="/nodeapi/getnetworkstatus";return ajaxPost(url,params,onSuccess,onFailure)}function listAnalyticsByBucketId(sessionKey,bucketId,analyticsType,onSuccess,onFailure){var params={"session-key":sessionKey,"bucket-id":bucketId,"analytics-type":analyticsType},url="/api/"+kupBucket+"/listanalyticsbybucketid";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketSetting(bucketId,onSuccess,onFailure){var params={"bucket-id":bucketId},url="/api/"+kupBucket+"/getbucketsetting";return ajaxPost(url,params,onSuccess,onFailure)}function saveReportQueryHistory(eventType,dateFrom,dateTo,deviceSelected,onSuccess,onFailure){var params={"event-type":eventType,"date-from":dateFrom,"date-to":dateTo,"device-selected":deviceSelected},url="/api/"+kupBucket+"/savereportqueryhistory";return ajaxPost(url,params,onSuccess,onFailure)}function getReportQueryHistory(eventType,onSuccess,onFailure){var params={"event-type":eventType},url="/api/"+kupBucket+"/getreportqueryhistory";return ajaxPost(url,params,onSuccess,onFailure)}function getVcaErrors(instanceId,offset,take,onSuccess,onFailure){var params={"instance-id":instanceId,offset:offset,take:take},url="/api/"+kupBucket+"/getvcaerrors";return ajaxPost(url,params,onSuccess,onFailure)}function searchCloudRecordings(deviceId,channelId,from,to,onSuccess,onFailure){var params={"device-id":deviceId,"channel-id":channelId,from:from,to:to},url="/api/"+kupBucket+"/searchcloudrecordings";return ajaxPost(url,params,onSuccess,onFailure)}function requestCloudRecordings(deviceId,channelId,from,to,onSuccess,onFailure){var params={"device-id":deviceId,"channel-id":channelId,from:from,to:to},url="/api/"+kupBucket+"/requestcloudrecordings";return ajaxPost(url,params,onSuccess,onFailure)}function deleteCloudRecordings(deviceId,channelId,from,to,onSuccess,onFailure){var params={"device-id":deviceId,"channel-id":channelId,from:from,to:to},url="/api/"+kupBucket+"/deletecloudrecordings";return ajaxPost(url,params,onSuccess,onFailure)}function findPendingUploadRequests(deviceId,channelId,from,to,onSuccess,onFailure){var params={"device-id":deviceId,"channel-id":channelId,from:from,to:to},url="/api/"+kupBucket+"/findpendinguploadrequests";return ajaxPost(url,params,onSuccess,onFailure)}function getPeriodicReportSettings(bucketId,onSuccess,onFailure){var params={"bucket-id":bucketId},url="/api/"+kupBucket+"/getperiodicreportsettings";return ajaxPost(url,params,onSuccess,onFailure)}function savePeriodicReportSettings(bucketId,settings,onSuccess,onFailure){var params={"bucket-id":bucketId,frequencies:JSON.stringify(settings.frequencies),"export-formats":JSON.stringify(settings.exportFormats),"delivery-methods":JSON.stringify(settings.deliveryMethods),"mailing-list":JSON.stringify(settings.mailingList),"ftp-details":JSON.stringify(settings.ftpDetails)},url="/api/"+kupBucket+"/saveperiodicreportsettings";return ajaxPost(url,params,onSuccess,onFailure)}function getPeriodicReports(frequency,from,to,skip,take,onSuccess,onFailure){var params={frequency:frequency,from:from,to:to,skip:skip,take:take},url="/api/"+kupBucket+"/getperiodicreports";return ajaxPost(url,params,onSuccess,onFailure)}function downloadPeriodicReport(reportId,format){var params={"report-id":reportId,format:format};sendGETRequest(params,"downloadperiodicreport")}function removePeriodicReport(reportId,onSuccess,onFailure){var params={"report-id":reportId},url="/api/"+kupBucket+"/removeperiodicreport";return ajaxPost(url,params,onSuccess,onFailure)}function exportAggregatedCSVReport(eventType,selectedGroups,fromDate,toDate,baseUnit,onSuccess,onFailure){var params={"event-type":eventType,"selected-groups":selectedGroups,"time-zone-offset":kupapi.timeZoneOffset,from:fromDate,to:toDate,"base-unit":baseUnit},url="/api/"+kupBucket+"/exportaggregatedcsvreport";requestDownloadUrl(url,params,onSuccess,onFailure)}function getDeviceLogs(platformDeviceId,skip,take,onSuccess,onFailure){var params={"platform-device-id":platformDeviceId,skip:skip,take:take},url="/api/"+kupBucket+"/getdevicelogs";return ajaxPost(url,params,onSuccess,onFailure)}function getBucketNotificationSettings(bucketId,onSuccess,onFailure){var params={"bucket-id":bucketId},url="/api/"+kupBucket+"/getbucketnotificationsettings";return ajaxPost(url,params,onSuccess,onFailure)}function updateBucketNotificationSettings(bucketId,eventType,notificationEnabled,videoRequired,onSuccess,onFailure){var params={"bucket-id":bucketId,"event-type":eventType,"notification-enabled":notificationEnabled,"video-required":videoRequired},url="/api/"+kupBucket+"/updatebucketnotificationsettings";return ajaxPost(url,params,onSuccess,onFailure)}function restoreBucketNotificationSettings(bucketId,onSuccess,onFailure){var params={"bucket-id":bucketId},url="/api/"+kupBucket+"/restorebucketnotificationsettings";return ajaxPost(url,params,onSuccess,onFailure)}function getUserNotificationSettings(onSuccess,onFailure){var params={},url="/api/"+kupBucket+"/getusernotificationsettings";return ajaxPost(url,params,onSuccess,onFailure)}function updateUserNotificationSettings(eventType,notifyMethods,onSuccess,onFailure){var params={"event-type":eventType,"notify-methods":JSON.stringify(notifyMethods)},url="/api/"+kupBucket+"/updateusernotificationsettings";return ajaxPost(url,params,onSuccess,onFailure)}function getAllowedNotifyMethods(onSuccess,onFailure){var params={},url="/api/"+kupBucket+"/getallowednotifymethods";return ajaxPost(url,params,onSuccess,onFailure)}function getAssignableNodeFeatures(bucketId,onSuccess,onFailure){var params={"bucket-id":bucketId},url="/api/"+kupBucket+"/getassignablenodefeatures";return ajaxPost(url,params,onSuccess,onFailure)}function getPOSSettings(onSuccess,onFailure){var params={},url="/api/"+kupBucket+"/getpossettings";return ajaxPost(url,params,onSuccess,onFailure)}function updatePOSSettings(updatedSettings,onSuccess,onFailure){var params={"import-enabled":updatedSettings.enabled,"ftp-details":JSON.stringify(updatedSettings.ftpDetails)},url="/api/"+kupBucket+"/updatepossettings";return ajaxPost(url,params,onSuccess,onFailure)}function addholiday(title,des,isEvent,isHoliday,isSignificant,from,to,countries,onSuccess,onFailure){var params={title:title,des:des,isEvent:isEvent,isHoliday:isHoliday,isSignificant:isSignificant,from:from,to:to,countries:countries},url="/api/"+kupBucket+"/addholiday";return ajaxPost(url,params,onSuccess,onFailure)}function getHolidays(sessionKey,onSuccess,onFailure){var params={sessionKey:sessionKey},url="/api/"+kupBucket+"/getholidays";return ajaxPost(url,params,onSuccess,onFailure)}function getCountryList(sessionKey,onSuccess,onFailure){var params={sessionKey:sessionKey},url="/api/"+kupBucket+"/getcountrylist";return ajaxPost(url,params,onSuccess,onFailure)}function deleteHoliday(holidayId,onSuccess,onFailure){var params={holidayId:holidayId},url="/api/"+kupBucket+"/deleteholiday";return ajaxPost(url,params,onSuccess,onFailure)}function editHoliday(id,title,des,isEvent,isHoliday,isSignificant,from,to,countries,onSuccess,onFailure){var params={id:id,title:title,des:des,isEvent:isEvent,isHoliday:isHoliday,isSignificant:isSignificant,from:from,to:to,countries:countries},url="/api/"+kupBucket+"/updateholiday";return ajaxPost(url,params,onSuccess,onFailure)}function getRecordedFileList(deviceId,channelId,from,to,onSuccess,onFailure){var params={"device-id":deviceId,"channel-id":channelId,from:from,to:to},url="/api/"+kupBucket+"/getrecordedfilelist";return ajaxPost(url,params,onSuccess,onFailure)}function downloadZippedRecordings(deviceId,channelId,from,to){var params={"device-id":deviceId,"channel-id":channelId,from:from,to:to};sendGETRequest(params,"downloadzippedrecordings")}function getUSBDrives(onSuccess,onFailure){var params={},url="/api/"+kupBucket+"/getusbdrives";return ajaxPost(url,params,onSuccess,onFailure)}function exportRecordingsToUSB(deviceId,channelId,from,to,usbIdentifier,onSuccess,onFailure){var params={"device-id":deviceId,"channel-id":channelId,from:from,to:to,"usb-identifier":usbIdentifier},url="/api/"+kupBucket+"/usbexportrecordings";return ajaxPost(url,params,onSuccess,onFailure)}function getPlatformInformation(onSuccess,onFailure){var params={},url="/api/"+kupBucket+"/getplatforminformation";return ajaxPost(url,params,onSuccess,onFailure)}function getAssignableRoleFeatures(onSuccess){var params={},url="/api/"+kupBucket+"/getassignablerolefeatures";return ajaxPost(url,params,onSuccess)}function getNodeObjectInfo(nodeId,onSuccess){var params={"platform-device-id":nodeId},url="/api/"+kupBucket+"/getnodeobjectinfo";return ajaxPost(url,params,onSuccess)}function getNodeLocalInfo(onSuccess){var params={},url="/nodeapi/getnodeinfo";return ajaxPost(url,params,onSuccess)}function updateMobileDeviceInfo(identifier,newName,onSuccess){var params={identifier:identifier,"new-name":newName},url="/api/"+kupBucket+"/updatemobiledeviceinfo";return ajaxPost(url,params,onSuccess)}function getNodeCameraStorage(nodeId,cameraCoreId,onSuccess){var params={"device-id":nodeId,"channel-id":cameraCoreId},url="/api/"+kupBucket+"/getnodecamerastorage";return ajaxPost(url,params,onSuccess)}var angularService=angular.element(document.body).injector(),kupBucket=angularService.get("AuthTokenFactory").getBucket(),kupSessionKey=angularService.get("AuthTokenFactory").getSessionKey(),kupUserId=angularService.get("AuthTokenFactory").getUserId(),apiRootUrl=angularService.get("KupOption").sysApiRootUrl,localizeResource=angularService.get("UtilsService").i18n,kupapi=window.kupapi||{};kupapi.CdnPath=apiRootUrl+"/public/css",kupapi.applicationType="cloud",kupapi.currentUserId=parseInt(kupUserId,10);var jwplayer=window.jwplayer||{};jwplayer.key=angularService.get("KupOption").jwplayerKey,angular.module("kai.cloudplayback",[]),angular.module("kai.cloudplayback").controller("CloudplaybackController",["KupOption","RouterStateService","UtilsService","AuthTokenFactory","$scope","$timeout","$q",function(KupOption,RouterStateService,UtilsService,AuthTokenFactory,$scope,$timeout,$q){function init(){var callback=function(){var dfd=$q.defer();return $timeout(function(){window.cloudPlayback.init(),dfd.resolve()},2e3),dfd.promise};mainCtrl.fn.toggleSideBar(function(){mainCtrl.block.promise=callback()})}var kupOpt=KupOption,mainCtrl=(UtilsService.i18n,UtilsService.notification,UtilsService.block,$scope.$parent.mainCtrl),cloudplaybackCtrl=this;cloudplaybackCtrl.apiRootUrl=kupOpt.sysApiRootUrl,init()}]);var camsltr={treeItemTemplate:"camSelectorItemTmpl",iconFolder:apiRootUrl+"/public/css/common/images/treeicons/",jqTreeId:null,kendoTree:null,preSelectedId:null,cancelled:!0,selectedCamera:null,parentLookupMap:{},cameraLookupMap:{},searchSource:[],deviceFilter:{models:null,minRelease:null,recordingEnabled:null}};camsltr.ItemType=Object.freeze({LABEL:"label",NODE4:"node4",NODE1:"node1",CAMERA:"camera"}),camsltr.icons={label:camsltr.iconFolder+"label.png",node4:camsltr.iconFolder+"node.png",node1:camsltr.iconFolder+"node.png",camera:camsltr.iconFolder+"node_cam.png"},camsltr.open=function(title,preSelectedId,deviceFilter,onSelected,onCancelled){
camsltr.preSelectedId=preSelectedId,camsltr.deviceFilter=$.extend(camsltr.deviceFilter,deviceFilter);var contentPage="app/cloudplayback/camselector.html";utils.openPopup(title,contentPage,null,null,!0,function(){if(camsltr.cancelled)onCancelled();else{var parentDevice=camsltr.parentLookupMap[camsltr.selectedCamera.id];onSelected(parentDevice,camsltr.selectedCamera.data)}})},camsltr.close=function(cancelled){camsltr.cancelled=cancelled,$(camsltr.jqTreeId).closest(".k-window-content").data("kendoWindow").close()},camsltr.generateTree=function(divId){camsltr.jqTreeId="#"+divId,camsltr._loading(!0),camsltr.getDevicesAsTree(function(deviceTree){camsltr.kendoTree=$(camsltr.jqTreeId).kendoTreeView({template:kendo.template($("#"+camsltr.treeItemTemplate).html()),dataSource:deviceTree,select:function(e){var selectedItem=camsltr.kendoTree.dataItem(e.node);camsltr._selectTreeItem(selectedItem,!1)}}).data("kendoTreeView"),$(camsltr.jqTreeId+" .k-in").on("dblclick",function(e){var dbClickedNode=$(e.target).closest(".k-item"),dataItem=camsltr.kendoTree.dataItem(dbClickedNode);if(0==dataItem.items.length){var camera=dataItem;camera.selectable&&(camsltr._selectTreeItem(camera,!1),camsltr.close(!1))}}),camsltr._initSearchBox(deviceTree),camsltr._customizeTreeStyle(),camsltr._allowSubmit(!1),camsltr.kendoTree.enable(".disabled_item",!1),camsltr.kendoTree.expand("> .k-group > .k-item"),camsltr._loading(!1),camsltr.preSelectedId&&camsltr._selectTreeItem(camsltr.cameraLookupMap[camsltr.preSelectedId],!0)})},camsltr.collapseFullTree=function(){camsltr.kendoTree.collapse(".k-item")},camsltr.getDevicesAsTree=function(callback){getUserDevices("",function(responseData){if("ok"!=responseData.result||null==responseData.devices)return utils.throwServerError(responseData.reason),void callback([]);var deviceTree=camsltr._convertToDeviceTree(responseData.devices);callback(deviceTree)},null)},camsltr._convertToDeviceTree=function(deviceList){camsltr.searchSource=[];var deviceTree=[];return $.each(deviceList,function(idx,dvc){var isNode=DvcMgr.isKaiNode(dvc),cleanedDvc=dvc;if(delete cleanedDvc.cameras,isNode){if(camsltr.deviceFilter.minRelease&&dvc.node.releaseNumber<camsltr.deviceFilter.minRelease)return!0;if(camsltr.deviceFilter.models&&camsltr.deviceFilter.models.indexOf(dvc.model.modelId)==-1)return!0;var nodeItem=camsltr._buildTreeItem(camsltr._getNodeIdentifier(dvc),dvc.name,camsltr.ItemType.NODE4,!1,cleanedDvc);$.each(dvc.node.cameras,function(idx,nodeCam){var camDisabled=!1;camsltr.deviceFilter.recordingEnabled&&nodeCam.cloudRecordingEnabled!==camsltr.deviceFilter.recordingEnabled&&(camDisabled=!0);var cameraItem=camsltr._buildTreeItem(camsltr._getCameraIdentifier(dvc,nodeCam),nodeCam.name,camsltr.ItemType.CAMERA,camDisabled,nodeCam);nodeItem.items.push(cameraItem),camDisabled||(cameraItem.searchableName=cleanedDvc.name+"  -  "+nodeCam.name,camsltr.searchSource.push(cameraItem),camsltr.parentLookupMap[cameraItem.id]=cleanedDvc,camsltr.cameraLookupMap[cameraItem.id]=cameraItem)}),utils.isListEmpty(nodeItem.items)||deviceTree.push(nodeItem)}}),$.each(deviceTree,function(i,root){root.isRoot=!0}),deviceTree},camsltr._initSearchBox=function(){var kendoInput=$(".camera_tree .search_bar .input").kendoAutoComplete({dataSource:camsltr.searchSource,dataTextField:"searchableName",filter:"contains",placeholder:localizeResource("select-by-node-or-cam"),select:function(e){var dataItem=this.dataItem(e.item.index());camsltr._selectTreeItem(dataItem,!0)},change:function(e){this.value("")}}).data("kendoAutoComplete");kendoInput.list.width(345),$(".camera_tree .search_bar .input").show()},camsltr._selectTreeItem=function(cameraItem,expandToSelection){camsltr.kendoTree.select($("#"+cameraItem.id)),expandToSelection&&$("#"+cameraItem.id).parentsUntil(".k-treeview").filter(".k-item").each(function(index,element){camsltr.kendoTree.expand($(this))}),cameraItem.selectable?(camsltr.selectedCamera=cameraItem,camsltr._allowSubmit(!0)):camsltr._allowSubmit(!1)},camsltr._loading=function(loading){kendo.ui.progress($(".cam_selector"),loading)},camsltr._buildTreeItem=function(identifier,displayName,itemType,disabled,dataObj){return{id:identifier,name:displayName,type:itemType,imageUrl:camsltr.icons[itemType],isRoot:!1,selectable:!disabled&&itemType==camsltr.ItemType.CAMERA,disabled:disabled,data:dataObj,items:[]}},camsltr._getLabelIdentifier=function(label){return label},camsltr._getNodeIdentifier=function(nodeDevice){return nodeDevice.id},camsltr._getCameraIdentifier=function(nodeDevice,nodeCamera){return null==nodeDevice?nodeCamera.nodeCoreDeviceId:nodeDevice.id+"_"+nodeCamera.nodeCoreDeviceId},camsltr._customizeTreeStyle=function(){var childItem=$(".camera_tree .child_item").closest(".k-top, .k-mid, .k-bot");childItem.addClass("lineage_line");var rootItem=$(".camera_tree .root_item").closest(".k-top, .k-mid, .k-bot");rootItem.addClass("lineage_line"),rootItem.addClass("separate_root");var rootGroup=$(".camera_tree .root_item").closest(".k-item");rootGroup.css("border-left","0px")},camsltr._allowSubmit=function(allow){var $btnSubmit=$(".cam_selector .select");allow?$btnSubmit.show():$btnSubmit.hide()};var cloudPlayback={periodBarId:"recStatusBar",jw:{playerId:"jwClPlyr"},selected:{node:null,nodeCamera:null,date:null,type:null,queryablePeriod:null,files:[],useNodeTimezone:null},kendo:{datePicker:null},autoRefresh:{enabled:!0,freq:1e4},cache:{bucketUsers:{}},storageWidget:null,API_TIME_FORMAT:"DDMMYYYYHHmmss"};cloudPlayback.Type=Object.freeze({VIDEO:"video",IMAGE:"image"}),cloudPlayback.init=function(){$(".filter_toolbar").removeClass("kupFakeHide"),cloudPlayback._initDatePicker(),setTimeout(function(){recSB.init(cloudPlayback.periodBarId,cloudPlayback._periodChangedHandler)},300),cloudPlayback.selected.type=cloudPlayback.Type.VIDEO,cloudPlayback._setCamera(null,null),cloudPlayback._setDate(moment()),cloudPlayback.setTimeZoneFlag(!0),cloudPlayback._startRefreshTimer(),cloudPlayback._initCache(),cloudPlayback._initStorageInfo()},cloudPlayback.triggerCameraChange=function(){var selectedCameraId=null;null!=cloudPlayback.selected.node&&null!=cloudPlayback.selected.nodeCamera&&(selectedCameraId=camsltr._getCameraIdentifier(cloudPlayback.selected.node,cloudPlayback.selected.nodeCamera));var nodeFilter={models:DvcMgr.getModelIdList(DvcMgr.NodeType.UBUNTU),minRelease:4.4,recordingEnabled:!0};camsltr.open(localizeResource("select-camera"),selectedCameraId,nodeFilter,function(node,selectedCamera){cloudPlayback._setCamera(node,selectedCamera)},function(){})},cloudPlayback.triggerDateChange=function(){cloudPlayback.kendo.datePicker.open()},cloudPlayback.setTimeZoneFlag=function(useNodeTimezone){cloudPlayback.selected.useNodeTimezone=useNodeTimezone,$(".rec_mgr .filter_toolbar .tz_option input[type=checkbox]").prop("checked",useNodeTimezone),cloudPlayback.searchRecordings(!0)},cloudPlayback.searchRecordings=function(paramsChanged,onCompleted){if(onCompleted=onCompleted||utils.doNothing,null==cloudPlayback.selected.node||null==cloudPlayback.selected.nodeCamera||null==cloudPlayback.selected.date||null==cloudPlayback.selected.type)return void onCompleted();cloudPlayback._checkAllowTzToggle();var target=moment(cloudPlayback.selected.date),from=moment(target.startOf("day")),to=moment(target.endOf("day"));cloudPlayback._loading(paramsChanged),searchCloudRecordings(cloudPlayback.selected.node.id,cloudPlayback.selected.nodeCamera.nodeCoreDeviceId,cloudPlayback._getAPITimestamp(from),cloudPlayback._getAPITimestamp(to),function(responseData){if(cloudPlayback._loading(!1),"ok"!=responseData.result)utils.throwServerError(responseData);else{var files=cloudPlayback._adjustRecordingTimes(responseData.files);recSB.generate(cloudPlayback.selected.date.toDate(),files,paramsChanged)}cloudPlayback._updateStorageInfo(),onCompleted()},null)},cloudPlayback.requestRecordings=function(){if(null!=cloudPlayback.selected.node&&null!=cloudPlayback.selected.nodeCamera&&null!=cloudPlayback.selected.date&&null!=cloudPlayback.selected.type&&null!=cloudPlayback.selected.queryablePeriod){var totalSize=0;$.each(cloudPlayback.selected.files,function(i,f){recSB.RecStatus.isRequestable(f.status)&&(totalSize+=f.fileSize)}),utils.popupConfirm(localizeResource("confirmation"),localizeResource("msg-confirm-recording-request",utils.bytesToMBString(totalSize)),function(choice){if(choice){var from=cloudPlayback.selected.queryablePeriod[0],to=cloudPlayback.selected.queryablePeriod[1];cloudPlayback._loading(!0),requestCloudRecordings(cloudPlayback.selected.node.id,cloudPlayback.selected.nodeCamera.nodeCoreDeviceId,cloudPlayback._getAPITimestamp(from),cloudPlayback._getAPITimestamp(to),function(responseData){return cloudPlayback._loading(!1),"ok"!=responseData.result?void utils.throwServerError(responseData):void cloudPlayback.searchRecordings(!1)},null)}})}},cloudPlayback.deleteRequestedFiles=function(){if(null!=cloudPlayback.selected.node&&null!=cloudPlayback.selected.nodeCamera&&null!=cloudPlayback.selected.date&&null!=cloudPlayback.selected.type&&null!=cloudPlayback.selected.queryablePeriod){var from=cloudPlayback.selected.queryablePeriod[0],to=cloudPlayback.selected.queryablePeriod[1];cloudPlayback._loading(!0),findPendingUploadRequests(cloudPlayback.selected.node.id,cloudPlayback.selected.nodeCamera.nodeCoreDeviceId,cloudPlayback._getAPITimestamp(from),cloudPlayback._getAPITimestamp(to),function(responseData){if(cloudPlayback._loading(!1),"ok"!=responseData.result)return void utils.throwServerError(responseData);var confirmationMsg=localizeResource("confirm-cancel-delete-recordings"),pendingRequests=responseData.requests;if(pendingRequests.length>0){var uniqueIdList=[],userList=[];if($.each(pendingRequests,function(i,req){var userId=req.requesterUserId;uniqueIdList.indexOf(userId)==-1&&userId!==kupapi.currentUserId&&(uniqueIdList.push(userId),userList.push(cloudPlayback.cache.bucketUsers[userId]))}),userList.length>0){var template=kendo.template($("#requesterTmpl").html());confirmationMsg=template(userList)+confirmationMsg}}utils.popupConfirm(localizeResource("confirmation"),confirmationMsg,function(choice){choice&&(cloudPlayback._loading(!0),deleteCloudRecordings(cloudPlayback.selected.node.id,cloudPlayback.selected.nodeCamera.nodeCoreDeviceId,cloudPlayback._getAPITimestamp(from),cloudPlayback._getAPITimestamp(to),function(responseData){return cloudPlayback._loading(!1),"ok"!=responseData.result?void utils.throwServerError(responseData):void cloudPlayback.searchRecordings(!1)},null))})})}},cloudPlayback.clearPeriodSelection=function(){cloudPlayback._setPlayerVisibility(!1),recSB.fn.clearBrush()},cloudPlayback.downloadSelection=function(){var downloadableList=[];$.each(cloudPlayback.selected.files,function(i,f){f.status==recSB.RecStatus.COMPLETED&&downloadableList.push(f)}),utils.popupConfirm(localizeResource("confirmation"),localizeResource("confirm-uploaded-file-download",downloadableList.length),function(proceed){proceed&&$.each(downloadableList,function(i,f){window.open(cloudPlayback._getDownloadLink(f))})})},cloudPlayback._setCamera=function(node,nodeCamera){var $cameraSelector=$(".rec_mgr .filter_toolbar .camera"),nodeName=localizeResource("select-camera"),cameraName=". . .";node&&nodeCamera&&(nodeName=node.name,cameraName=nodeCamera.name),$cameraSelector.find(".primary").text(nodeName),$cameraSelector.find(".secondary").text(cameraName),cloudPlayback.selected.node=node,cloudPlayback.selected.nodeCamera=nodeCamera,cloudPlayback.searchRecordings(!0),cloudPlayback._updateStorageInfo()},cloudPlayback._setDate=function(selectedDate){return selectedDate.isValid()?(cloudPlayback.selected.date=selectedDate,void cloudPlayback.searchRecordings(!0)):void console.log("invalid date")},cloudPlayback._startRefreshTimer=function(){!function delayedRefresh(){setTimeout(function(){cloudPlayback.autoRefresh.enabled&&!recSB.isSelectionActive()?cloudPlayback.searchRecordings(!1,delayedRefresh):delayedRefresh()},cloudPlayback.autoRefresh.freq)}()},cloudPlayback._setAutoRefresh=function(enabled){cloudPlayback.autoRefresh.enabled=enabled},cloudPlayback._initCache=function(){getBucketUsers("",function(responseData){return"ok"!=responseData.result?void utils.throwServerError(responseData):void $.each(responseData.users,function(i,user){cloudPlayback.cache.bucketUsers[user.userId]=user})})},cloudPlayback._initStorageInfo=function(){var color={ok:"#3498DB",warning:"#f6ae40",danger:"#CF000F"};cloudPlayback.storageWidget=new ProgressBar.Line(".camera_info_box .storage_info .progress-bar",{duration:500,step:function(state,circle){var colorHex,percent=circle.value();colorHex=percent>.9?color.danger:percent>.7?color.warning:color.ok,circle.path.setAttribute("stroke",colorHex)}})},cloudPlayback._updateStorageInfo=function(){var node=cloudPlayback.selected.node,nodeCam=cloudPlayback.selected.nodeCamera,$cameraInfoBox=$(".camera_info_box");return node&&nodeCam?void getNodeCameraStorage(node.id,nodeCam.nodeCoreDeviceId,function(responseData){var limitMB=responseData.info.recordingLimitMB,usageMB=responseData.info.recordingUsageMB,remainingMB=limitMB-usageMB,percentUsed=usageMB/limitMB;usageMB>limitMB&&(console.log("Storage usage over the limit (MB):",remainingMB),remainingMB=0,percentUsed=1);var $storageInfo=$cameraInfoBox.find(".storage_info"),infoText=localizeResource("storage-limit-tmpl",remainingMB,limitMB);$cameraInfoBox.show(),$storageInfo.find(".details").html(infoText),cloudPlayback.storageWidget.animate(0===limitMB?0:percentUsed)}):void $cameraInfoBox.hide()},cloudPlayback._updatePlayList=function(selectedFiles){var playList=[];$.each(selectedFiles,function(idx,file){if(recSB.RecStatus.allowedToPlay(file.status)&&!utils.isNullOrEmpty(file.url)){var periodName=cloudPlayback._formatPeriodForJw([moment(file.startTime),moment(file.endTime)]);playList.push({title:periodName,image:kupapi.CdnPath+"/common/images/play_jw_opaque.png",file:file.url.play})}});var isEmpty=0==playList.length,$selectMsg=$(".rec_mgr .select_file_msg"),$jwPlayer=$(".rec_mgr #"+cloudPlayback.jw.playerId);$selectMsg.toggle(isEmpty),$jwPlayer.toggle(!isEmpty),isEmpty||cloudPlayback._playWithJW(playList)},cloudPlayback._playWithJW=function(playlist){var jwInstance=jwplayer(cloudPlayback.jw.playerId).setup({playlist:playlist,width:"100%",height:"100%",autostart:!1,mute:!0,listbar:{position:"right",size:280},flashplayer:"static/js/plugin/jwplayer/jwplayer.flash.swf",html5player:"static/js/plugin/jwplayer/jwplayer.html5.min.js"});jwInstance.onError(function(e){e&&"Error loading media: File could not be played"===e.message&&utils.popupAlert(localizeResource("error-cloud-bandwidth-limit"))})},cloudPlayback._adjustUI=function(){mainJS.toggleLeftBar();var $toolBox=$("#movingToolBox"),leftBarWidth=$("#sidebar").outerWidth();mainJS.whenLeftBarOpened(function(){$toolBox.is(":visible")&&$toolBox.animate({right:"-="+leftBarWidth},200),utils.disableWithOverlay($(".rec_mgr"),!0)}),mainJS.whenLeftBarClosed(function(){$toolBox.is(":visible")&&$toolBox.animate({right:"+="+leftBarWidth},200),utils.disableWithOverlay($(".rec_mgr"),!1)})},cloudPlayback._initDatePicker=function(){var now=moment();cloudPlayback.kendo.datePicker=$(".rec_mgr .kendo_picker").kendoDatePicker({format:"d MMM yyyy",max:now.toDate(),value:now.toDate(),footer:!1,origin:"top right",animation:{open:{effects:"slideIn:right",duration:200},close:{duration:100}},change:function(){cloudPlayback._setDate(moment(this.value()))}}).data("kendoDatePicker"),cloudPlayback.kendo.datePicker.readonly(),$(".rec_mgr .date_selector").show()},cloudPlayback._periodChangedHandler=function(newPeriod,selectedFiles){var momentPeriod=[moment(newPeriod[0]),moment(newPeriod[1])];if(cloudPlayback.selected.files=selectedFiles,selectedFiles.length>0){var firstFile=selectedFiles[0],lastFile=selectedFiles[selectedFiles.length-1];cloudPlayback.selected.queryablePeriod=[moment(firstFile.startTime),moment(lastFile.endTime)]}if(1==selectedFiles.length){var f=selectedFiles[0];console.log("Status:",f.status,", Period:",moment(f.startTime).format("hh:mm:ss"),"-",moment(f.endTime).format("hh:mm:ss"),", Size:",utils.bytesToMBString(f.fileSize),", Progress:",f.progress,", url:",f.url)}var selectionCancelled=momentPeriod[0].isSame(momentPeriod[1]);selectionCancelled&&(cloudPlayback.selected.queryablePeriod=null),cloudPlayback._setAutoRefresh(selectionCancelled),cloudPlayback._updateToolBoxBtns(selectedFiles),cloudPlayback._updatePlayList(selectedFiles),cloudPlayback._setPlayerVisibility(!selectionCancelled)},cloudPlayback._updateToolBoxBtns=function(selectedFiles){var showRequestBtn=!1,showCancelBtn=!1,showDownloadBtn=!1,$requestBtn=$("#movingToolBox .options .request"),$cancelBtn=$("#movingToolBox .options .cancel"),$downloadBtn=$("#movingToolBox .options .download");$.each(selectedFiles,function(idx,file){recSB.RecStatus.isRequestable(file.status)&&(showRequestBtn=!0),recSB.RecStatus.isDeletable(file.status)&&(showCancelBtn=!0),file.status==recSB.RecStatus.COMPLETED&&(showDownloadBtn=!0)}),$requestBtn.toggle(showRequestBtn),$cancelBtn.toggle(showCancelBtn),$downloadBtn.toggle(showDownloadBtn)},cloudPlayback._getDownloadLink=function(file){var filename=cloudPlayback.selected.nodeCamera.name+"_"+moment(file.startTime).format("HHmmss")+"-"+moment(file.endTime).format("HHmmss")+".mp4",errorLink=window.location.host+"/errorlanding/corebandwidthlimit";return file.url.download+"?action=download&customname="+utils.sanitizeForURL(filename,"")+"&errorlink="+encodeURIComponent(errorLink)},cloudPlayback._formatPeriod=function(period){var format="h:mm a",start=period[0].format(format),end=period[1].format(format);return start+" - "+end},cloudPlayback._formatPeriodForJw=function(period){var format="h:mm:ss",start=period[0].format(format),end=period[1].format(format);return start+" - "+end},cloudPlayback._getMockFiles=function(dt){for(var mockList=[],states=Object.keys(recSB.RecStatus),zeroZero=dt.startOf("day"),start=zeroZero.valueOf(),i=0;i<96;i++){var oneSlot=9e5,current=start+i*oneSlot;1!=utils.getRandomInteger(0,4)&&mockList.push({startTime:current,endTime:current+oneSlot-1,fileSize:utils.getRandomInteger(1e4,1e5),url:"rtmp://fms.12E5.edgecastcdn.net/0012E5/mp4:videos/8Juv1MVa-485.mp4",progress:utils.getRandomInteger(0,100),status:states[utils.getRandomInteger(0,states.length)]})}return mockList},cloudPlayback._setPlayerVisibility=function(visible){var $displayArea=$(".rec_mgr .display_area");$displayArea.toggle(visible)},cloudPlayback._getNodeTimeZone=function(){var tz={name:cloudPlayback.selected.node.node.settings.timezone,tzOffsetMins:cloudPlayback.selected.node.node.settings.tzOffsetMins};return tz},cloudPlayback._getAPITimestamp=function(browserDt){var shiftedDt;if(cloudPlayback.selected.useNodeTimezone){var nodeTz=cloudPlayback._getNodeTimeZone();shiftedDt=cloudPlayback._shiftTimeZone(browserDt,nodeTz.tzOffsetMins)}else shiftedDt=browserDt;var utcDt=moment.utc(shiftedDt);return utcDt.format(cloudPlayback.API_TIME_FORMAT)},cloudPlayback._shiftTimeZone=function(dt,offsetMins){var newDt=moment(dt);return newDt.utcOffset(offsetMins),newDt.add(dt.utcOffset()-newDt.utcOffset(),"minutes"),newDt},cloudPlayback._adjustRecordingTimes=function(files){if(cloudPlayback.selected.useNodeTimezone){var nodeTz=cloudPlayback._getNodeTimeZone(),tzDiffMillis=60*(nodeTz.tzOffsetMins-moment().utcOffset())*1e3;$.each(files,function(i,f){f.startTime+=tzDiffMillis,f.endTime+=tzDiffMillis})}return files},cloudPlayback._checkAllowTzToggle=function(){var nodeTz=cloudPlayback._getNodeTimeZone(),allow=nodeTz.tzOffsetMins!=moment().utcOffset(),$tzToggleBtn=$(".rec_mgr .filter_toolbar .tz_option");$tzToggleBtn.toggle(allow),allow&&$(".rec_mgr .filter_toolbar .tz_name").text("("+nodeTz.name+")")},cloudPlayback._loading=function(loading){kendo.ui.progress($(".rec_mgr"),loading)};var DvcMgr=function(){var cfg={cacheExpiry:3e4},DeviceStatus={UNKNOWN:"UNKNOWN",CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED",parse:function(statusString){var status=DeviceStatus.UNKNOWN;return $.each(DeviceStatus,function(key,value){if(value==statusString)return status=DeviceStatus[key],!1}),status}},cache={lastRequested:0,userDevices:{},platformIdMap:{},coreIdMap:{},deviceNameMap:{},channelNameMap:{},channelStatusMap:{},snapshots:{}},updateDevices=function(deviceList){cache.lastRequested=(new Date).getTime(),cache.userDevices={},cache.platformIdMap={},cache.coreIdMap={},cache.deviceNameMap={},cache.channelNameMap={},$.each(deviceList,function(i,dvc){cache.userDevices[dvc.deviceId]=dvc,cache.platformIdMap[dvc.id]=dvc.deviceId,cache.coreIdMap[dvc.deviceId]=dvc.id,cache.deviceNameMap[dvc.deviceId]=dvc.name,isKaiNode(dvc)?$.each(dvc.node.cameras||[],function(i2,cam){cache.channelNameMap[dvc.deviceId+"_"+cam.nodeCoreDeviceId]=cam.name,cache.channelStatusMap[dvc.deviceId+"_"+cam.nodeCoreDeviceId]=cam.status}):(cache.channelNameMap[dvc.deviceId+"_0"]="1",cache.channelStatusMap[dvc.deviceId+"_0"]=dvc.status)})},init=function(callback){var now=(new Date).getTime();return now-cache.lastRequested<cfg.cacheExpiry?void callback():void getUserDevices("",function(responseData){"ok"!=responseData.result||null==responseData.devices?(utils.throwServerError(responseData),updateDevices([])):updateDevices(responseData.devices),callback()})},isKaiNode=function(device){return device.model.capabilities.indexOf("node")!=-1},toPlatformId=function(coreDeviceId){return cache.coreIdMap[coreDeviceId]},toCoreId=function(platformDeviceId){return cache.platformIdMap[platformDeviceId]},getDevice=function(coreDeviceId){return cache.userDevices[coreDeviceId]},getDeviceName=function(coreDeviceId){var name=cache.deviceNameMap[coreDeviceId];return utils.isNullOrEmpty(name)?localizeResource("n/a"):name},getChannelName=function(coreDeviceId,channelId){var name=cache.channelNameMap[coreDeviceId+"_"+channelId];return utils.isNullOrEmpty(name)?localizeResource("n/a"):name},getDeviceStatus=function(coreDeviceId){var device=cache.userDevices[coreDeviceId];return null==device?DeviceStatus.UNKNOWN:DeviceStatus.parse(device.status)},getChannelStatus=function(coreDeviceId,channelId){var status=cache.channelStatusMap[coreDeviceId+"_"+channelId];return utils.isNullOrEmpty(status)?DeviceStatus.UNKNOWN:DeviceStatus.parse(status)},getCameraSnapshot=function(coreDeviceId,channelId,callback){var cacheKey=coreDeviceId+"-"+channelId;return cache.snapshots[cacheKey]?void callback(cache.snapshots[cacheKey]):void getLiveVideoUrl("",coreDeviceId,channelId,"http/jpeg",function(responseData){if("ok"==responseData.result&&null!=responseData.url&&responseData.url.length>0){var jpegUrl=responseData.url[0];cache.snapshots[cacheKey]=jpegUrl,callback(jpegUrl)}else callback(null)},null)},viewNodeLocalInfo=function(){var contentPage="/node/localinfo";utils.openPopup(localizeResource("node-information"),contentPage,null,null,!0,function(){})},getModelIdList=function(nodeType){var info=backend.NodeEnvInfo[nodeType];return info?info.modelIdList:[]};return{DeviceStatus:DeviceStatus,NodeType:backend.NodeEnv,ready:init,isKaiNode:isKaiNode,toPlatformId:toPlatformId,toCoreId:toCoreId,getDevice:getDevice,getDeviceName:getDeviceName,getChannelName:getChannelName,getDeviceStatus:getDeviceStatus,getChannelStatus:getChannelStatus,getCameraSnapshot:getCameraSnapshot,viewNodeLocalInfo:viewNodeLocalInfo,getModelIdList:getModelIdList}}();kupapi.debugMode=!1,kupapi.timeZoneOffset=0,kupapi.TIME_FORMAT="dd/MM/yyyy HH:mm:ss",kupapi.TIME_ONLY_FORMAT="HH:mm",kupapi.API_TIME_FORMAT="ddMMyyyyHHmmss",kupapi.privateCloud=!1,kupapi.mapSource="google",kupapi.platformVersion=null,kupapi.internetStatus=null;var busyOverlayVisibility=!1,kupDefaultErrorHandler=function(jqXHR,extra){},recSB={containerId:null,showLegend:"cloud"==kupapi.applicationType,current:{date:new Date,periodMillis:[0,0],files:[]},minDuration:15,fn:{clearBrush:null},evt:{periodChanged:null},padding:{top:15,right:30,bottom:10,left:20}};recSB.RecStatus=Object.freeze({UNREQUESTED:"UNREQUESTED",REQUESTED:"REQUESTED",UPLOADING:"UPLOADING",COMPLETED:"COMPLETED",RETRYING:"RETRYING",ABORTED:"ABORTED",MISSING:"MISSING",isRequestable:function(status){var list=[this.UNREQUESTED,this.ABORTED];return list.indexOf(status)!=-1},isDeletable:function(status){var list=[this.REQUESTED,this.UPLOADING,this.COMPLETED,this.RETRYING];return list.indexOf(status)!=-1},allowedToPlay:function(status){var list=[this.UPLOADING,this.COMPLETED];return list.indexOf(status)!=-1}}),recSB.statusColors={UNREQUESTED:"#004D60",REQUESTED:"#f6ae40",UPLOADING:"#428bca",COMPLETED:"#8dc051",RETRYING:"#7E3F12",ABORTED:"#ff2a3f",MISSING:"transparent"},recSB.init=function(containerId,periodChanged){recSB.containerId=containerId,recSB.evt.periodChanged=periodChanged,recSB._draw()},recSB.generate=function(targetDate,streamFiles,animate){recSB.current.date=targetDate,recSB.current.files=recSB._prepareFiles(streamFiles),recSB._draw(animate),recSB._handleEmptyRecordingsList()},recSB.reset=function(){recSB.current.files=[],recSB._draw(!1),$(".rec_mgr .msg_no_recordings").hide()},recSB.remove=function(){if(null!=recSB.containerId){recSB.fn.clearBrush&&recSB.fn.clearBrush();var container=document.getElementById(recSB.containerId);if(null!=container)for(;container.firstChild;)container.removeChild(container.firstChild)}},recSB.isSelectionActive=function(){return $("#movingToolBox").is(":visible")},recSB._prepareFiles=function(files){return $.each(files,function(i,f){f.roundedStart=recSB._roundTo15MinMarks(f.startTime),f.roundedEnd=recSB._roundTo15MinMarks(f.endTime)}),files},recSB._draw=function(paramsChanged){function brushed(e){var origExtent=brush.extent(),rounded0=floorMinutes(origExtent[0]),rounded1=floorMinutes(origExtent[1]);rounded1.getTime()-rounded0.getTime()<recSB.minDuration&&rounded1.setMinutes(rounded1.getMinutes()+recSB.minDuration);var snappedExtent=[rounded0,rounded1];d3.select(this).call(brush.extent(snappedExtent));var rectExtent=gBrush.select("rect.extent"),position=rectExtent.node().getBoundingClientRect();recSB._updatePeriodInfoBox(snappedExtent,position)}function floorMinutes(dt){for(var minutes=dt.getMinutes(),intervals=[0,15,30,45,60],i=1;i<intervals.length;i++)if(minutes<intervals[i]){var rounded=intervals[i-1];return new Date(dt.getFullYear(),dt.getMonth(),dt.getDate(),dt.getHours(),rounded,0)}return 0}function brushEnded(){var period=brush.extent(),from=period[0].getTime(),to=period[1].getTime();if(recSB.current.periodMillis[0]!=from||recSB.current.periodMillis[1]!=to){recSB.current.periodMillis=[from,to];var selectedFiles=[];recSB.current.files.forEach(function(file){var startTime=file.roundedStart;startTime>=from&&startTime<to&&selectedFiles.push(file)}),recSB.evt.periodChanged(period,selectedFiles)}}recSB.remove();var $wrapper=$("#"+recSB.containerId).parent(),svgW=$wrapper.width()-recSB.padding.right,svgH=$wrapper.height(),innerW=svgW-(recSB.padding.left+recSB.padding.right),innerH=svgH-(recSB.padding.top+recSB.padding.bottom),current=recSB.current.date,start=new Date(current.getFullYear(),current.getMonth(),current.getDate(),0,0,0),end=new Date(current.getFullYear(),current.getMonth(),current.getDate()+1,0,0,0),barCount=96,tickLabelHeight=42,legendHeight=10,legendColorWidth=10,chartH=innerH-(tickLabelHeight+legendHeight),barWidth=innerW/barCount,barMaxHeight=chartH,xScale=d3.time.scale().domain([start,end]).range([0,innerW]),brush=d3.svg.brush().x(xScale).on("brush",brushed).on("brushend",brushEnded),svgContainer=d3.select("#"+recSB.containerId).append("svg").attr("width",svgW).attr("height",svgH-5),contentWrapper=svgContainer.append("g").attr("transform","translate("+recSB.padding.left+", "+recSB.padding.top+")"),segments=contentWrapper.selectAll("rect").data(recSB.current.files).enter().append("rect").attr("shape-rendering","crispEdges").attr("stroke-width",0).attr("stroke","#505050").attr("fill-opacity",function(d){return d.status==recSB.RecStatus.UNREQUESTED?.5:1}).attr("x",function(d,i){var startDt=new Date(d.roundedStart);return xScale(startDt)}).attr("y",function(d){return chartH-recSB._getSegmentHeight(d,chartH)}).attr("width",function(d){var durationWidth=barWidth*((d.roundedEnd-d.roundedStart)/9e5);return durationWidth}).attr("height",function(d,i){return recSB._getSegmentHeight(d,barMaxHeight)}).attr("fill",function(d,i){return recSB.statusColors[d.status]}).attr("opacity",.9);if(paramsChanged){var stillBars=segments.filter(function(d){return d.status!=recSB.RecStatus.UPLOADING});stillBars.attr("opacity",0),stillBars.transition().duration(500).attr("opacity",.9)}var progressBars=segments.filter(function(d){return d.status==recSB.RecStatus.UPLOADING}),dur=500;if(function blinkUploading(){progressBars.transition().duration(dur).attr("fill",recSB.statusColors[recSB.RecStatus.COMPLETED]).each("end",function(){d3.select(this).transition().duration(dur).attr("fill",function(d,i){return recSB.statusColors[d.status]})}),setTimeout(blinkUploading,2*dur)}(),contentWrapper.append("g").attr("class","x axis").attr("transform","translate(0,"+chartH+")").call(d3.svg.axis().scale(xScale).orient("bottom").ticks(d3.time.hours,1).tickPadding(4)).selectAll("text").attr("x",-16).style("text-anchor",null).style("font-size",11),contentWrapper.append("g").attr("class","x grid").attr("transform","translate(0,"+chartH+")").call(d3.svg.axis().scale(xScale).orient("bottom").ticks(d3.time.minutes,15).tickSize(-chartH).tickFormat("")).selectAll(".tick").classed("minor",function(d){return d.getMinutes()}),recSB.showLegend){var legendWrapper=svgContainer.append("g").attr("transform","translate(10, "+innerH+")"),legendEntries=[recSB.RecStatus.UNREQUESTED,recSB.RecStatus.REQUESTED,recSB.RecStatus.UPLOADING,recSB.RecStatus.COMPLETED,recSB.RecStatus.RETRYING,recSB.RecStatus.ABORTED],legendWrapper=function(){var html='<ul class="legendWrapper" style="width:'+svgW+'px;">';return $.each(legendEntries,function(index,text){html+="<li class='status'>",html+='<span class="colors" style="width:'+legendColorWidth+"px;height:"+legendHeight+"px;background-color:"+recSB.statusColors[text]+'"></span>',html+=localizeResource("rec-status-"+text),html+="</li>"}),html+="</ul>"};$("#"+recSB.containerId).append(legendWrapper)}if(!utils.isListEmpty(recSB.current.files)){var gBrush=contentWrapper.append("g").attr("class","brush").call(brush);gBrush.selectAll("rect").attr("height",chartH+tickLabelHeight).attr("transform","translate(0,"+-recSB.padding.top+")"),recSB.fn.clearBrush=function(){var tmpDur=recSB.minDuration;recSB.minDuration=0,brush.clear().event(d3.select(".brush"));var $movingInfoBox=$("#movingToolBox");$movingInfoBox.hide(),recSB.minDuration=tmpDur}}},recSB._updatePeriodInfoBox=function(period,position){var $movingInfoBox=$("#movingToolBox"),$periodInfo=$movingInfoBox.find(".period_status");$periodInfo.html(recSB._formatPeriod(period));var top=-58,borderWidthOffset=2,$svgBox=$("#"+recSB.containerId),boxWidth=$movingInfoBox.outerWidth(),right=$svgBox.outerWidth()-(position.left+boxWidth)+borderWidthOffset+22;right<0&&(right=0),$movingInfoBox.css("position","absolute"),$movingInfoBox.css("top",top),$movingInfoBox.css("right",right),$movingInfoBox.show()},recSB._handleEmptyRecordingsList=function(){var empty=utils.isListEmpty(recSB.current.files),$emptyMsg=$(".rec_mgr .msg_no_recordings");empty?$emptyMsg.show():$emptyMsg.hide()},recSB._formatPeriod=function(period){var format="h:mm tt",start=kendo.toString(period[0],format),end=kendo.toString(period[1],format);return start+" - "+end},recSB._roundTo15MinMarks=function(origMillis){var dtOrig=moment(origMillis),dtZero=moment(dtOrig).minutes(0).seconds(0).milliseconds(0),plusOrMinus=1,roundTimes=[dtZero,moment(dtZero).add(15,"minutes"),moment(dtZero).add(30,"minutes"),moment(dtZero).add(45,"minutes"),moment(dtZero).add(60,"minutes")],roundedMillis=origMillis;return $.each(roundTimes,function(i,roundTime){var minus=moment(roundTime).subtract(plusOrMinus,"minutes"),plus=moment(roundTime).add(plusOrMinus,"minutes");return!(!dtOrig.isBefore(minus)&&!dtOrig.isAfter(plus))||(roundedMillis=roundTime.toDate().getTime(),!1)}),roundedMillis},recSB._getSegmentHeight=function(segment,maxHeight){
return segment.progress>0?maxHeight*(segment.progress/100):maxHeight};var utils={},alertMsgTimeOut=null,infoMsgTimeOut=null,activePopupId="",flag=0,flag1=0,loadingTimer=null;utils.throwServerError=function(responseData){utils.hideLoadingOverlay();var errorMsg="",redirect=!1;return null==responseData||null==responseData.reason?void console.warn("Server error! responseData:"+JSON.stringify(responseData)):("timeout"==responseData.reason?(errorMsg=localizeResource("session-expired")+"!",redirect=!0):errorMsg=localizeResource(responseData.reason),void utils.popupAlert(errorMsg,function(){redirect&&(document.getElementById("iframePopup")?window.parent.location.href="/"+kupBucket:window.location.href="/"+kupBucket)}))},utils.popupAlert=function(alertMsg,callback){var contentHtml='<div style="min-height:40px">'+alertMsg+"</div>",kendoWindow=$("<div />").kendoWindow({visible:!1,title:localizeResource("system-message"),resizable:!1,modal:!0,width:300,close:callback});kendoWindow.data("kendoWindow").content(contentHtml).center().open(),$(".k-window-title").css("height","30px")},utils.detectBrowser=function(){function testCSS(prop){return prop in document.documentElement.style}var isOpera=!(!window.opera||!window.opera.version),isFirefox=testCSS("MozBoxSizing"),isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome=!isSafari&&testCSS("WebkitTransform"),isIE=testCSS("msTransform"),browser="";return isOpera?browser="opera":isFirefox?browser="firefox":isSafari?browser="safari":isChrome?browser="chrome":isIE&&(browser="ie"),browser},utils.detectOS=function(){var OSName="Unknown OS";return navigator.appVersion.indexOf("Win")!=-1&&(OSName="Windows"),navigator.appVersion.indexOf("Mac")!=-1&&(OSName="MacOS"),navigator.appVersion.indexOf("X11")!=-1&&(OSName="UNIX"),navigator.appVersion.indexOf("Linux")!=-1&&(OSName="Linux"),OSName},utils.convertToUTC=function(dateObj){return new Date(dateObj.getUTCFullYear(),dateObj.getUTCMonth(),dateObj.getUTCDate(),dateObj.getUTCHours(),dateObj.getUTCMinutes(),dateObj.getUTCSeconds())},utils.convertToHourBoundriesUTC=function(dateObj,type){return"from"==type?(dateObj.setUTCMinutes(0),dateObj.setUTCSeconds(0),new Date(dateObj.getUTCFullYear(),dateObj.getUTCMonth(),dateObj.getUTCDate(),dateObj.getUTCHours(),dateObj.getUTCMinutes(),dateObj.getUTCSeconds())):"to"==type?dateObj.getUTCMinutes()>0?(dateObj.setUTCHours(dateObj.getUTCHours()+1),dateObj.setUTCMinutes(0),dateObj.setUTCSeconds(0),new Date(dateObj.getUTCFullYear(),dateObj.getUTCMonth(),dateObj.getUTCDate(),dateObj.getUTCHours(),dateObj.getUTCMinutes(),dateObj.getUTCSeconds())):(dateObj.setUTCMinutes(0),dateObj.setUTCSeconds(0),new Date(dateObj.getUTCFullYear(),dateObj.getUTCMonth(),dateObj.getUTCDate(),dateObj.getUTCHours(),dateObj.getUTCMinutes(),dateObj.getUTCSeconds())):void 0},utils.convertUTCtoLocal=function(dateObj){if(null!=dateObj){var d=new Date;return dateObj.setMinutes(dateObj.getMinutes()-d.getTimezoneOffset()),dateObj}},utils.popupConfirm=function(title,confirmMsg,callback){function onClosed(){callback(choice)}var choice=!1;$("#popupWin .confirm_msg").html(confirmMsg);var contentHtml=$("#popupWin").html(),kendoWindow=$("#popupWin").kendoWindow({visible:!1,title:title,resizable:!1,modal:!0,width:300,close:onClosed});$("#popupWin").parent().find(".k-window-action").css("visibility","hidden"),kendoWindow.data("kendoWindow").content(contentHtml).center().open(),$("#btnConfirmOk").click(function(){choice=!0,$("#popupWin").data("kendoWindow").close()}),$("#btnConfirmCancel").click(function(){choice=!1,$("#popupWin").data("kendoWindow").close()})},utils.slideDownAlert=function(timestamp,alertType,deviceName){var localDt=utils.convertUTCtoLocal(kendo.parseDate(timestamp,kupapi.TIME_FORMAT));timestamp=kendo.toString(localDt,kupapi.TIME_FORMAT);var msgHtml='<div class="alert_box_title">'+timestamp+'</div><div class="alert_box_content"><label class="alert_box_label">'+localizeResource("device-name")+"</label>: "+deviceName+'<br/><label class="alert_box_label">'+localizeResource("event-type")+"</label>: "+localizeResource(alertType)+"<br/></div>",notifyBox=document.getElementById("notifyBox")?$("#notifyBox"):window.parent.$("#notifyBox"),alertBox=document.getElementById("alertBox")?$("#alertBox"):window.parent.$("#alertBox");clearTimeout(alertMsgTimeOut),clearTimeout(infoMsgTimeOut),notifyBox.hide(),alertBox.html(msgHtml),alertBox.show("slide",{direction:"up"},1e3),alertMsgTimeOut=setTimeout(function(){alertBox.hide("slide",{direction:"up"},1e3)},8e3)},utils.slideDownInfo=function(notifyMsg){var msgHtml='<div class="success_image"><span>'+notifyMsg+"</span></div>",notifyBox=null,alertBox=null;document.getElementById("notifyBox")?(notifyBox=$("#notifyBox"),alertBox=$("#alertBox"),clearTimeout(alertMsgTimeOut),clearTimeout(infoMsgTimeOut),alertBox.hide(),notifyBox.html(msgHtml),notifyBox.fadeIn(1e3),infoMsgTimeOut=setTimeout(function(){notifyBox.fadeOut(1e3)},3e3)):(notifyBox=window.parent.$("#notifyBox"),alertBox=window.parent.$("#alertBox"),clearTimeout(window.parent.alertMsgTimeOut),clearTimeout(window.parent.infoMsgTimeOut),alertBox.hide(),notifyBox.html(msgHtml),notifyBox.fadeIn(1e3),window.parent.infoMsgTimeOut=window.parent.setTimeout(function(){notifyBox.fadeOut(1e3)},3e3))},utils.removeLineBreaks=function(nlStr){return nlStr.replace(new RegExp("\n","g")," ")},utils.getJSonObject=function(value){return $.parseJSON(value.replace(/&quot;/gi,'"'))},utils.showLoadingOverlay=function(){$(".darkened-overlay").show(),$(".loading-icon-overlay").show(),kendo.ui.progress($(".k-window-content"),!0)},utils.showLoadingTextOverlay=function(displayText,showCloseButton){if($("#loadingText").html(displayText),$(".darkened-overlay").show(),$(".loading-text-overlay").show(),showCloseButton){$("#loadingTimeSeconds").html(""),$("#loadingTimeSeconds").show();var timeTaken=0;loadingTimer=setInterval(function(){timeTaken++,$("#loadingTimeSeconds").html(timeTaken+"s"),timeTaken>10&&$("#btnLoadingCancel").show()},1e3)}},utils.hideLoadingOverlay=function(){$(".darkened-overlay").hide(),$(".loading-icon-overlay").hide(),$(".loading-text-overlay").hide(),$("#btnLoadingCancel").hide(),$("#loadingTimeSeconds").hide(),kendo.ui.progress($(".k-window-content"),!1),loadingTimer&&clearInterval(loadingTimer)},utils.loadIframe=function(iframeName,url){var $iframe=$("#"+iframeName);if($iframe.length)return $iframe.attr("src",url),!1},utils.preloadImage=function(imgUrl,onSuccess,onFailure){var img=new Image;utils.showLoadingTextOverlay(localizeResource("loading-image"),!0),$(img).load(function(){utils.hideLoadingOverlay(),onSuccess()}).error(function(){utils.hideLoadingOverlay(),onFailure()}).attr("src",imgUrl)},utils.createTooltip=function(divId,position,content){var domElement,contentHtml="<span style='font-size:11px;text-align:left; display: inline-block; max-width:200px'>"+content+"</span>";domElement=document.getElementById(divId)?$("#"+divId):$("."+divId),domElement.kendoTooltip({position:position,content:contentHtml}).data("kendoTooltip")},utils.createDateTimeRangeSelection=function(fromDivId,toDivId){var now=new Date,todayStart=new Date(now.getFullYear(),now.getMonth(),now.getDate(),0,0,0),todayEnd=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,0,0,(-1)),start=$("#"+fromDivId).kendoDateTimePicker({interval:60,format:"dd/MM/yyyy HH:mm",timeFormat:"HH:mm",value:todayStart,change:function(e){var startDate=start.value();startDate&&end.min(new Date(startDate))}}).data("kendoDateTimePicker"),end=$("#"+toDivId).kendoDateTimePicker({interval:60,format:"dd/MM/yyyy HH:mm",timeFormat:"HH:mm",value:todayEnd,change:function(e){var endDate=end.value();endDate&&start.max(new Date(endDate))}}).data("kendoDateTimePicker");start.max(end.value()),end.min(start.value()),end.max(todayEnd)},utils.checkInternetAccess=function(onlineCallback,offlineCallback){var img=document.createElement("img");img.onload=onlineCallback,img.onerror=offlineCallback,img.src="http://pic2.pbsrc.com/navigation/brand-logo.png?v="+Math.random()},utils.getRandomInteger=function(min,max){return Math.floor(Math.random()*max+min)},utils.getRandomDecimal=function(min,max){return Math.random()*max+min},utils.getScript=function(src){document.write('<script type="text/javascript" src="'+src+'"></script>')},utils.captureEnterKey=function(divId,callback){$("#"+divId).bind("keypress",function(e){var code=e.keyCode?e.keyCode:e.which;13==code&&callback()})},utils.httpGet=function(theUrl){var xmlHttp=null;return xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText},utils.openPopup=function(title,contentUrl,width,height,isModel,onPopupClosed){function onClosed(e){$(".k-animation-container").css("display","none"),$(".k-list-container").css("display","none"),$(".pac-container").css("display","none"),$(".k-list-container").css("transform",""),$("#"+winId).html(""),onPopupClosed(e)}var winId=Math.random().toString(8).slice(2);$(document.body).append('<div id="'+winId+'" style="overflow: hidden"></div>');var winOptions={};winOptions.title=title,winOptions.content=contentUrl,winOptions.resizable=!1,winOptions.modal=isModel,winOptions.close=onClosed,winOptions.visible=!1,utils.isNullOrEmpty(width)||(winOptions.width=width),utils.isNullOrEmpty(height)||(winOptions.height=height);var autoAdjust=utils.isNullOrEmpty(width)||utils.isNullOrEmpty(height);autoAdjust&&(winOptions.refresh=function(){this.center()});$("#"+winId).kendoWindow(winOptions).data("kendoWindow").center().open()},utils.formatDrmsDate=function(datetime){var dateObj=new Date(datetime),hr=dateObj.getHours(),min=dateObj.getMinutes();hr<10&&(hr="0"+hr),min<10&&(min="0"+min);var dateStr=hr+":"+min;return dateStr},utils.formatDate=function(date){if(""!=date){var tempDate=date.split(" "),tempTime=tempDate[3].split(":");"Jan"==tempDate[1]?tempDate[1]="01":"Feb"==tempDate[1]?tempDate[1]="02":"Mar"==tempDate[1]?tempDate[1]="03":"Apr"==tempDate[1]?tempDate[1]="04":"May"==tempDate[1]?tempDate[1]="05":"Jun"==tempDate[1]?tempDate[1]="06":"Jul"==tempDate[1]?tempDate[1]="07":"Aug"==tempDate[1]?tempDate[1]="08":"Sep"==tempDate[1]?tempDate[1]="09":"Oct"==tempDate[1]?tempDate[1]="10":"Nov"==tempDate[1]?tempDate[1]="11":"Dec"==tempDate[1]&&(tempDate[1]="12");var formatedDate=tempDate[2]+tempDate[1]+tempDate[5]+tempTime[0]+tempTime[1]+tempTime[2];return formatedDate}return""},utils.convertDrmsDate=function(timeType,date,range){var tempDate=null;if(tempDate=date,"start"==range){if("daily"==timeType)return tempDate;if("weekly"==timeType)return new Date(tempDate-864e5*tempDate.getDay());if("monthly"==timeType)return tempDate.setMonth(tempDate.getMonth(),1),tempDate;if("yearly"==timeType)return tempDate.setMonth(0,1),tempDate}else if("end"==range){if("daily"==timeType)return tempDate.setHours(23,59,59),tempDate;if("weekly"==timeType)return tempDate.setDate(tempDate.getDate()+(6-tempDate.getDay())),tempDate.setHours(23,59,59),tempDate;if("monthly"==timeType)return tempDate.setMonth(tempDate.getMonth()+1,0),tempDate;if("yearly"==timeType)return tempDate.setMonth(11,31),tempDate.setHours(23,59,59),tempDate}},utils.populateChannels=function(channelCount,divId){for(var channelListId="#"+divId,channList=[],dataSource=null,i=0;i<channelCount;i++){var value=i+1;channList.push({name:value,nodeCoreDeviceId:i})}channList.length>0?(dataSource=new kendo.data.DataSource({data:channList}),$(channelListId).data("kendoDropDownList").setDataSource(dataSource)):(dataSource=new kendo.data.DataSource({data:[]}),$(channelListId).data("kendoDropDownList").setDataSource(dataSource),$(channelListId).data("kendoDropDownList").element.val(""),$(channelListId).data("kendoDropDownList").text(""))},utils.populateNodeNames=function(nodeList,divId){var channelListId="#"+divId,dataSource=null;nodeList.length>0?(dataSource=new kendo.data.DataSource({data:nodeList}),$(channelListId).data("kendoDropDownList").setDataSource(dataSource)):(dataSource=new kendo.data.DataSource({data:[]}),$(channelListId).data("kendoDropDownList").setDataSource(dataSource),$(channelListId).data("kendoDropDownList").element.val(""),$(channelListId).data("kendoDropDownList").text(""))},utils.collapseAllRows=function(gridId){var grid=$("#"+gridId).data("kendoGrid");grid.tbody.find(">tr.k-grouping-row").each(function(e){grid.collapseRow(this)})},utils.expandAllRows=function(gridId){var grid=$("#"+gridId).data("kendoGrid");grid.tbody.find(">tr.k-grouping-row").each(function(e){grid.expandRow(this)})},utils.isNullOrEmpty=function(str){return null==str||""==str},utils.popupAuthentication=function(presetCompanyId,allowOTP,callback){var presetInfo={companyId:presetCompanyId,allowOTP:allowOTP},url="/login/authenticate/"+JSON.stringify(presetInfo);utils.openPopup(localizeResource("authentication"),url,335,null,!0,function(){callback(authWin.sessionKeyResult)})},utils.centerDivObject=function(jqDivObject){var winWidth=$(window).width(),winHeight=$(window).height(),divWidth=jqDivObject.width(),divHeight=jqDivObject.height(),top=(winHeight-divHeight)/2,left=(winWidth-divWidth)/2;jqDivObject.css("position","absolute"),jqDivObject.css("top",top),jqDivObject.css("left",left)},utils.sameday=function(date1,date2){return date1.getUTCFullYear()==date2.getUTCFullYear()&&date1.getUTCMonth()==date2.getUTCMonth()&&date1.getUTCDate()==date2.getUTCDate()},utils.tryParseJson=function(str){try{var ret=JSON.parse(str);return""==ret&&(ret={}),ret}catch(e){return{}}},utils.getMapSize=function(map){return Object.keys(map).length},utils.modulo=function(number,divisor){return number%divisor},utils.checkFlashPlayer=function(browser){if("ie"==browser)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){return!1}if("firefox"==browser||"chrome"==browser||"opera"==browser){var isExistFlashPlayer=navigator.plugins["Shockwave Flash"];if(!isExistFlashPlayer)return!1}return!0},utils.viewSnapshot=function(coreDeviceId,channelId){var contentPage="/device/viewsnapshot/"+coreDeviceId+"-"+channelId;utils.openPopup(localizeResource("view-snapshot"),contentPage,null,null,!0,function(){utils.hideLoadingOverlay()})},utils.checkDeviceCompleteInfo=function(device){return device.model.capabilities.indexOf("node")!=-1&&void 0===device.node?(console.log(device.name+" doesnot have node properties"),!1):!(device.model.capabilities.indexOf("node")===-1&&device.model.channels<1)||(console.log(device.name+" doesnot have channel on it"),!1)},utils.formatSerialNumber=function(serialNumber){for(var dashedNumber="",groupSize=5,i=0;i<serialNumber.length;i++)dashedNumber+=serialNumber[i],serialNumber.length!=i+1&&0==utils.modulo(i+1,groupSize)&&(dashedNumber+=" - ");return dashedNumber},utils.removeArrayEntry=function(value,Array){var index=$.inArray(value,Array);~index&&Array.splice(index,1)},utils.isValidEmail=function(emailAddress){var pattern=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return pattern.test(emailAddress)},utils.convertToCurrency=function(value){if(isNaN(value))return value;var number=parseFloat(value);return number>=1e9?number/1e9+"BN":number>=1e6?number/1e5+"M":number>=1e3?number/1e3+"K":value},utils.getLatLngByAddress=function(address,callback,onError){reverseGeocode(address,function(responseData){if("ok"!=responseData.result)return void onError(responseData);var location={lng:responseData.lng,lat:responseData.lat};callback(location)},onError)},utils.getDateDifference=function(date1,date2){var date1Millis=date1.getTime(),date2Millis=date2.getTime(),differenceObject={},differenceMillis=date2Millis>date1Millis?date2Millis-date1Millis:date1Millis-date2Millis;return differenceObject.days=Math.floor(differenceMillis/36e5/24),differenceObject.hours=Math.floor(differenceMillis/36e5%24),differenceObject.minutes=Math.floor(differenceMillis/6e4%60),differenceObject.seconds=Math.floor(differenceMillis/1e3%24),differenceObject},utils.combineDeviceChannelIDs=function(deviceId,channelId){if(!utils.isNullOrEmpty(deviceId)&&!utils.isNullOrEmpty(channelId))return deviceId+"-"+channelId},utils.isValidDir=function(directoryString){var pattern=new RegExp(/^[0-9a-zA-Z\/\-_\s]+$/i);return pattern.test(directoryString)},utils.containsAll=function(array1,array2){for(var i=0,len=array1.length;i<len;i++)if($.inArray(array1[i],array2)==-1)return!1;return!0},utils.containsAny=function(array1,array2){for(var i=0,len=array1.length;i<len;i++)if($.inArray(array1[i],array2)!==-1)return!0;return!1},utils.permutate=function(list,length){var perm=list.map(function(val){return[val]}),generate=function(perm,maxLen,currLen){if(currLen===maxLen)return perm;for(var i=0,len=perm.length;i<len;i++)for(var currPerm=perm.shift(),k=0;k<list.length;k++)perm.push(currPerm.concat(list[k]));return generate(perm,maxLen,currLen+1)};return generate(perm,length,1)},utils.requestUserInput=function(inputName,callback){var saved=!1,inputText="",contentHtml=$(".input_request_win").html(),kendoWindow=$(".input_request_win").kendoWindow({visible:!1,title:inputName,resizable:!1,modal:!0,width:200,close:function(){callback(saved,inputText)}});kendoWindow.data("kendoWindow").content(contentHtml).center().open();var $inputBox=$(".input_request_win input[name=userInput]");$(".input_request_win .btn_save").click(function(){inputText=$inputBox.val(),utils.isNullOrEmpty(inputText)||(saved=!0,$(".input_request_win").data("kendoWindow").close())}),$(".input_request_win .btn_cancel").click(function(){saved=!1,$(".input_request_win").data("kendoWindow").close()})},utils.isListEmpty=function(list){return null==list||0==list.length},utils.browsingOnNode=function(){var hostname=window.location.hostname;return"localhost"==hostname||"127.0.0.1"==hostname},utils.toAPITimestamp=function(utcDate){return kendo.toString(utcDate,kupapi.API_TIME_FORMAT)},utils.getLocalTimestamp=function(millis){var localDt=new Date(millis);return kendo.toString(localDt,kupapi.TIME_FORMAT)},utils.getUTCTimestamp=function(millis){var localDt=new Date(millis),utcDt=utils.convertToUTC(localDt);return kendo.toString(utcDt,kupapi.TIME_FORMAT)},utils.replaceAll=function(str,find,replace){return str.replace(new RegExp(find,"g"),replace)},utils.randomAlphanumeric=function(length){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<length;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text},utils.copyToClipBoard=function(text){var $win=$(".text_copier"),$input=$win.find("input"),$btn=$win.find(".btn_copy");$input.val(text),$win.kendoWindow({visible:!1,title:localizeResource("copy"),resizable:!1,modal:!0,close:function(){}}).data("kendoWindow").center().open(),$btn.on("click",function(event){try{var copyTextArea=$input[0];copyTextArea.select();document.execCommand("copy")}catch(e){console.error(e)}$win.data("kendoWindow").close()})},utils.openScheduleViewer=function(periodsOfDays){visPrd.init(periodsOfDays);var contentPage="/vca/visualizeschedule";utils.openPopup(localizeResource("schedule-viewer"),contentPage,null,null,!0,function(){})},utils.padFixedLength=function(num,length,char){return char=char||"0",num+="",num.length>=length?num:new Array(length-num.length+1).join(char)+num},utils.formatTimeZone=function(offsetMins){var sign=offsetMins<0?"-":"+",offsetH=utils.padFixedLength(offsetMins/60,2),offsetM=utils.padFixedLength(offsetMins%60,2);return sign+offsetH+":"+offsetM},utils.CIDRToNetmask=function(cidr){var mask=4294967295<<32-cidr,arr=[mask>>>24,mask>>16&255,mask>>8&255,255&mask];return arr.join(".")},utils.displayBase64Image=function(maskBase64){var dataUrl="data:image/jpeg;base64,"+maskBase64,win=window.open();$(win.document.body).html('<img src="'+dataUrl+'" />')},utils.getCircularPolygon=function(center,r,N){for(var points=[],n=1;n<=N;n++)points.push({x:r*Math.cos(2*Math.PI*n/N)+center.x,y:r*Math.sin(2*Math.PI*n/N)+center.y});return points},utils.bytesToMBString=function(bytes){return Math.round(bytes/1048576)+" MB"},utils.sanitizeForURL=function(str,replaceChar){return str.replace(/[^a-zA-Z0-9-_.]/g,replaceChar)},utils.flashSupported=function(popupInstallLink){return!!FlashDetect.installed||(popupInstallLink&&$(".install_flash_warning").kendoWindow({visible:!1,title:localizeResource("system-message"),resizable:!1,modal:!0,width:350,close:function(){}}).data("kendoWindow").center().open(),!1)},utils.disableWithOverlay=function($targetElement,disable){var leftBarActive=mainJS.isLeftBarActive(),position=$targetElement.position(),$header=$("#header"),$overlay=$(".ele_busy_overlay");$overlay.css({position:"absolute","z-index":1e3,top:position.top+$header.outerHeight(),left:position.left+(leftBarActive?250:0),width:$targetElement.outerWidth(),height:$targetElement.outerHeight(),background:"#333",opacity:.5}),$overlay.toggle(disable)},utils.equalIgnoreCase=function(s1,s2){return null!=s1&&null!=s2&&s1.toLowerCase()===s2.toLowerCase()},utils.doNothing=function(){};